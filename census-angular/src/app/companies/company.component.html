<app-messages [show]="showMsg" [message]="messageInfo" [type]="typeMessage"></app-messages>

<div class="row justify-content-center">
  <div class="col-md-11 d-flex align-items-center">
    <i class="bi bi-collection me-2 icon-style"></i>
    <span class="section-title">Companies</span>
  </div>
</div>

<div class="row justify-content-center mt-2">
  <div class="col-11 d-flex justify-content-between align-items-center">

    <!-- Input de búsqueda al extremo izquierdo con ancho tipo col-6 -->
    <div style="width: 50%;">
      <div class="input-group">
        <input
          type="text"
          class="form-control placeholder-input"
          placeholder="Example: Company A"
          [(ngModel)]="searchTerm"
          aria-label="Search by Name"
          aria-describedby="button-addon2"
        />
        <button class="btn btn-outline-secondary" type="button" id="button-addon2" (click)="getCompanies(1)">
          <i class="bi bi-search"></i>
          <span class="search-btn">Search</span>
        </button>
      </div>
    </div>

    <!-- Botón al extremo derecho -->
    <div>
      <button type="button" class="btn custom-btn" data-bs-toggle="modal" data-bs-target="#addCompanyModal">
        <i class="bi bi-plus-circle"></i>
        New Company
      </button>
    </div>
  </div>
  <!-- Fila de tags para filtrar -->
  <div class="row justify-content-center mt-3">
    <div class="col-11" style="padding-left: 0px;">
      <div class="d-flex align-items-center flex-wrap gap-2">
        <span class="me-2">Filter by Tag:</span>

        <!-- Selector de tags -->
        <select class="form-select form-select-sm" style="width: auto;"
                [(ngModel)]="selectedTag" (change)="onTagChange(selectedTag)">
          <option value="">All Tags</option>
          <option *ngFor="let tag of tags" [value]="tag.id">{{ tag.name }}</option>
        </select>

        <!-- Botón para limpiar filtro (opcional) -->
        <button *ngIf="selectedTag" class="btn btn-sm btn-outline-secondary ms-2"
                (click)="clearTagFilter()">
          Clear
        </button>
      </div>
    </div>
  </div>
</div>

<div class="row justify-content-center table-row">
  <div class="col-md-11">
    <table class="table text-center">
      <thead>
      <tr>
        <th scope="col" class="text-start">
          <div class="d-flex align-items-center">
            <span class="section-number-title">Name</span>
            <button type="button" class="btn btn-link p-0 ms-2" (click)="toggleSortDirection()">
              <i class="bi" [ngClass]="{'bi-arrow-up': direction === 'asc', 'bi-arrow-down': direction === 'desc'}"></i>
            </button>
          </div>
        </th>
        <th scope="col" class="text-start">
          <span class="section-number-title">Members</span>
        </th>
        <th scope="col" class="text-start">
          <span class="section-number-title">Plan ID</span>
        </th>
        <th scope="col" class="text-start">
          <span class="section-number-title">Status</span>
        </th>
        <th scope="col">
          <span class="section-number-title">Actions</span>
        </th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let company of companies">
        <th scope="row" class="text-start">
          <span class="section-number-data">
            {{ company.name }}
          </span>
          <div *ngIf="company.tags?.length" class="mt-1">
            <span *ngFor="let tag of company.tags" class="badge bg-secondary me-1">
              {{ tag }}
            </span>
          </div>
        </th>
        <td class="text-start">
          <span class="section-number-data">
            {{ company.members_count }}
          </span>
        </td>
        <td class="text-start">
          <span class="section-number-data">
            {{ company.dct_plan_id }}
          </span>
        </td>
        <td class="text-start">
          <div class="form-check form-switch d-flex align-items-center">
            <input
              class="form-check-input"
              type="checkbox"
              role="switch"
              [checked]="company.is_active"
              id="switchCheckChecked-{{ company.id }}"
              (click)="onToggleActive($event, company, false)"/>
            <label
              class="form-check-label ms-2"
              [for]="'switchCheckChecked-' + company.id">
              <span class="section-number-data">Active</span>
            </label>
          </div>
        </td>
        <td>
          <button type="button" (click)="showDetails(company)" class="btn btn-link" data-bs-toggle="modal"
                  data-bs-target="#showCompanyModal">
            <i class="bi bi-eye"></i>
          </button>

          <button type="button" (click)="prepareEditCompany(company)" class="btn btn-link" data-bs-toggle="modal"
                  data-bs-target="#editCompanyModal">
            <i class="bi bi-pencil text-success"></i>
          </button>

          <button type="button" (click)="readyToRemove(company)" class="btn btn-link" data-bs-toggle="modal"
                  data-bs-target="#removeCompanyModal">
            <i class="bi bi-trash3 text-danger"></i>
          </button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<nav *ngIf="totalPages > 1" aria-label="Company pagination" class="mt-3 d-flex justify-content-center">
  <ul class="pagination">
    <li class="page-item" [class.disabled]="currentPage === 1">
      <button class="page-link directions-btn" (click)="goToPage(currentPage - 1)">Previous</button>
    </li>

    <li
      class="page-item"
      *ngFor="let page of [].constructor(totalPages); let i = index"
      [class.active]="i + 1 === currentPage">
      <button class="page-link directions-btn" (click)="goToPage(i + 1)">
        {{ i + 1 }}
      </button>
    </li>

    <li class="page-item" [class.disabled]="currentPage === totalPages">
      <button class="page-link directions-btn" (click)="goToPage(currentPage + 1)">Next</button>
    </li>
  </ul>
</nav>


<!-- Modal Create Company -->
<div class="modal fade" id="addCompanyModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <form [formGroup]="companyForm" (ngSubmit)="onSubmitCreate()">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">
            <i class="bi bi-building me-2 icon-style"></i>
            <span class="section-title">New Company</span>
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <div class="container">
            <div class="row">
              <!-- General Data -->
              <div class="col-md-4 mb-3">
                <label class="section-number-title-section">General Data</label>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-building"></i> Name:</label>
                  <input type="text" formControlName="name" class="form-control mt-1 placeholder-input"
                         [ngClass]="{ 'is-invalid': companyForm.get('name')?.touched && companyForm.get('name')?.invalid }" required />
                  <div class="invalid-feedback" *ngIf="companyForm.get('name')?.touched && companyForm.get('name')?.invalid">
                    <span class="error-text">Group Name is required.</span>
                  </div>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-credit-card-2-front"></i> DTC Plan ID:</label>
                  <input type="text" formControlName="dct_plan_id" class="form-control mt-1 placeholder-input" />
                </div>

                <!-- Checkbox y Dropdown para Grupo -->
                <div class="section-number-title-light mt-3">
                  <label class="mb-1">Group</label>
                  <select
                    formControlName="group_id"
                    class="form-select">
                    <option value="">Select a group</option>
                    <option *ngFor="let group of groups" [value]="group.id">
                      {{ group.name }}
                    </option>
                  </select>

                  <div class="form-check mb-2">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="notGroupCheckbox"
                      formControlName="not_group"
                      (change)="toggleGroupSelection()">
                    <label class="form-check-label" for="notGroupCheckbox">
                      I don't have a group
                    </label>
                  </div>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-geo"></i> Address:</label>
                  <input type="text" formControlName="address" class="form-control mt-1 placeholder-input" />
                </div>

                <div class="mt-3 d-flex align-items-center">
                  <label class="title-info me-2 d-flex align-items-center">
                    <i class="bi bi-check-circle me-1"></i>
                    Status:
                  </label>
                  <div class="form-check form-switch mb-0">
                    <input class="form-check-input" type="checkbox" role="switch"
                           id="activeSwitch" formControlName="is_active" />
                  </div>
                </div>
              </div>

              <!-- Contact Info -->
              <div class="col-md-4 mb-3">
                <label class="section-number-title-section">Contact Info</label>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-person"></i> Contact Name:</label>
                  <input type="text" formControlName="contact_name" class="form-control mt-1 placeholder-input"
                         [ngClass]="{ 'is-invalid': companyForm.get('contact_name')?.touched && companyForm.get('contact_name')?.invalid }" />
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-envelope"></i> Contact Email:</label>
                  <input type="email" formControlName="contact_email" class="form-control mt-1 placeholder-input"
                         [ngClass]="{ 'is-invalid': companyForm.get('contact_email')?.touched && companyForm.get('contact_email')?.invalid }" />
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-telephone"></i> Contact Phone:</label>
                  <input type="text" formControlName="contact_phone" class="form-control mt-1 placeholder-input" />
                </div>
              </div>

              <!-- Billing Info -->
              <div class="col-md-4 mb-3">
                <label class="section-number-title-section">Billing Info</label>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-geo"></i> Billing Address:</label>
                  <input type="text" formControlName="address_billing" class="form-control mt-1 placeholder-input" />
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-person"></i> Billing Contact Name:</label>
                  <input type="text" formControlName="contact_billing" class="form-control mt-1 placeholder-input" />
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-envelope"></i> Billing Email:</label>
                  <input type="email" formControlName="billing_email" class="form-control mt-1 placeholder-input" />
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-telephone"></i> Billing Phone:</label>
                  <input type="text" formControlName="billing_phone" class="form-control mt-1 placeholder-input" />
                </div>
              </div>
            </div>

            <!-- Accounts Info -->
            <div class="row mt-3">
              <div class="col-md-6 mb-3">
                <label class="section-number-title-section">Accounts Info</label>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-person"></i> Primary Name:</label>
                  <input type="text" formControlName="primary_name" class="form-control mt-1 placeholder-input" />
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-envelope"></i> Primary Email:</label>
                  <input type="email" formControlName="primary_email" class="form-control mt-1 placeholder-input" />
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-person"></i> Secondary Name:</label>
                  <input type="text" formControlName="secondary_name" class="form-control mt-1 placeholder-input" />
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-envelope"></i> Secondary Email:</label>
                  <input type="email" formControlName="secondary_email" class="form-control mt-1 placeholder-input" />
                </div>
              </div>

              <!-- Tags -->
              <div class="col-md-6 mb-3">
                <label class="section-number-title-section">Tags</label>
                <div class="tags-container d-flex flex-wrap gap-2 mt-2">
                  <span *ngFor="let tag of tags"
                        class="tag-chip badge rounded-pill"
                        [ngClass]="{
                          'bg-primary text-white': isTagSelected(tag.id),
                          'bg-light text-dark border': !isTagSelected(tag.id)
                        }"
                        style="cursor: pointer; padding: 0.5rem 1rem; font-size: 0.9rem;"
                        (click)="toggleTagSelection(tag.id)">
                    {{ tag.name }}
                    <span *ngIf="isTagSelected(tag.id)" class="ms-1">✓</span>
                  </span>
                </div>
              </div>
            </div>

            <!-- Benefits -->
            <div class="row mt-4">
              <div class="col-md-12">
                <label class="section-number-title-section mb-2">Benefits</label>
                <div formArrayName="benefits">
                  <div class="row">
                    <div class="col-md-4 mb-3" *ngFor="let benefit of benefits; let i = index">
                      <div class="d-flex justify-content-between align-items-center">
                        <div class="form-check">
                          <input type="checkbox" class="form-check-input" [formControlName]="i"
                                 [id]="'benefitCheck' + i"
                                 (change)="toggleBenefit(benefit.id, benefit.name, getCheckedValue($event))" />
                          <label class="form-check-label ms-1 title-info-data" [for]="'benefitCheck' + i">
                            {{ benefit.name }}
                          </label>
                        </div>
                        <input *ngIf="companyForm.get('benefits')?.value[i]"
                               type="number" class="form-control form-control-sm placeholder-input"
                               style="max-width: 80px;" [value]="benefit.price"
                               (input)="updateBenefitPrice(benefit.id, getInputValue($event))"
                               placeholder="$" />
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>

        <div class="modal-footer">
          <button type="submit"
                  class="btn btn-primary custom-btn d-flex align-items-center"
                  [disabled]="companyForm.invalid || isLoading">
            <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2" role="status"
                  aria-hidden="true"></span>
            {{ isLoading ? 'Saving...' : 'Save Company' }}
          </button>
          <button type="button" class="btn btn-secondary custom-btn-return" data-bs-dismiss="modal">Close</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal Edit Company -->
<div class="modal fade" id="editCompanyModal" tabindex="-1" aria-labelledby="editCompanyModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editCompanyModalLabel">
          <i class="bi bi-building me-2 icon-style"></i>
          <span class="section-title">Edit Company</span>
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <div class="container">
          <div class="row">
            <!-- General Data -->
            <div class="col-md-4 mb-3">
              <label class="section-number-title-section">General Data</label>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-building"></i> Name:</label>
                <input type="text" class="form-control mt-1 placeholder-input" [(ngModel)]="companyDetailEdit.name" />
              </div>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-geo"></i> Address:</label>
                <input type="text" class="form-control mt-1 placeholder-input" [(ngModel)]="companyDetailEdit.address" />
              </div>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-credit-card-2-front"></i> DTC Plan ID:</label>
                <input type="text" class="form-control mt-1 placeholder-input" [(ngModel)]="companyDetailEdit.dtc_plan_id" />
              </div>

              <!-- Checkbox y Dropdown para Grupo -->
              <div class="section-number-title-light mt-3">
                <label class="mb-1">Group</label>

                <select
                  [(ngModel)]="companyDetailEdit.group_id"
                  name="group_id"
                  class="form-select"
                  [disabled]="companyDetailEdit.not_group">
                  <option [ngValue]="">Select a group</option>
                  <option *ngFor="let group of groups" [ngValue]="group.id">
                    {{ group.name }}
                  </option>
                </select>

                <div class="form-check mb-2">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="notGroupCheckbox"
                    [(ngModel)]="companyDetailEdit.not_group"
                    name="not_group"
                    (change)="toggleEditCompanyGroupSelection()">
                  <label class="form-check-label" for="notGroupCheckbox">
                    I don't have a group
                  </label>
                </div>
              </div>


              <div class="mt-3 d-flex align-items-center">
                <label class="title-info me-2 d-flex align-items-center">
                  <i class="bi bi-check-circle me-1"></i>
                  Status:
                </label>
                <div class="form-check form-switch mb-0">
                  <input class="form-check-input" type="checkbox" role="switch"
                         [checked]="companyDetailEdit.is_active"
                         id="switchActiveCompany-{{ companyDetailEdit.id }}"
                         (change)="onToggleActive($event, companyDetailEdit,false)" />
                </div>
              </div>
            </div>

            <!-- Contact Info -->
            <div class="col-md-4 mb-3">
              <label class="section-number-title-section">Contact Info</label>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-person"></i> Contact Name:</label>
                <input type="text" class="form-control mt-1 placeholder-input" [(ngModel)]="companyDetailEdit.contact_name" />
              </div>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-envelope"></i> Contact Email:</label>
                <input type="email" class="form-control mt-1 placeholder-input" [(ngModel)]="companyDetailEdit.contact_email" />
              </div>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-telephone"></i> Contact Phone:</label>
                <input type="text" class="form-control mt-1 placeholder-input" [(ngModel)]="companyDetailEdit.contact_phone" />
              </div>
            </div>

            <!-- Billing Info -->
            <div class="col-md-4 mb-3">
              <label class="section-number-title-section">Billing Info</label>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-geo"></i> Billing Address:</label>
                <input type="text" class="form-control mt-1 placeholder-input" [(ngModel)]="companyDetailEdit.billing_address" />
              </div>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-person"></i> Billing Contact Name:</label>
                <input type="text" class="form-control mt-1 placeholder-input" [(ngModel)]="companyDetailEdit.contact_billing" />
              </div>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-envelope"></i> Billing Email:</label>
                <input type="email" class="form-control mt-1 placeholder-input" [(ngModel)]="companyDetailEdit.billing_email" />
              </div>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-telephone"></i> Billing Phone:</label>
                <input type="text" class="form-control mt-1 placeholder-input" [(ngModel)]="companyDetailEdit.billing_phone" />
              </div>
            </div>
          </div>

          <!-- Accounts Info -->
          <div class="row mt-3">
            <div class="col-md-6">
              <label class="section-number-title-section mb-2">Accounts Info</label>

              <ng-container *ngIf="companyDetailEdit?.admin_accounts !== undefined; else loadingAccounts">
                <div *ngIf="companyDetailEdit?.admin_accounts && companyDetailEdit.admin_accounts.length > 0; else noAccounts">
                  <ul class="list-unstyled">
                    <li *ngFor="let account of companyDetailEdit.admin_accounts" class="d-flex align-items-center justify-content-between mb-3">
                      <div class="d-flex align-items-center">
                        <div class="rounded-circle d-flex justify-content-center align-items-center"
                             style="width: 32px; height: 32px; background-color: #007bff; color: white; font-size: 20px;">
                          <i class="bi bi-person"></i>
                        </div>
                        <div class="ms-3">
                          <div class="account-text">{{ account.name }}</div>
                          <div class="account-text">{{ account.email }}</div>
                        </div>
                      </div>
                      <div>
                        <i class="bi bi-trash text-danger icon-right-space" (click)="removeCompanyAdminAccount(account)"></i>
                      </div>
                    </li>
                  </ul>
                </div>
                <ng-template #noAccounts>
                  <p class="no-accounts mt-2">
                    <i class="bi bi-person-x"></i>
                    No accounts available.
                  </p>
                </ng-template>
              </ng-container>

              <ng-template #loadingAccounts>
                <span class="skeleton-loader" style="width: 200px; height: 15px; display: inline-block;"></span>
              </ng-template>
            </div>

            <!-- Tags -->
            <div class="col-md-6">
              <label class="section-number-title-section">Tags</label>
              <div class="tags-container d-flex flex-wrap gap-2 mt-2">
                <span *ngFor="let tag of tags"
                      class="tag-chip badge rounded-pill"
                      [ngClass]="{
                        'bg-primary text-white': isTagSelected(tag.id),
                        'bg-light text-dark border': !isTagSelected(tag.id)
                      }"
                      style="cursor: pointer; padding: 0.5rem 1rem; font-size: 0.9rem;"
                      (click)="toggleTagSelection(tag.id)">
                  {{ tag.name }}
                  <span *ngIf="isTagSelected(tag.id)" class="ms-1">✓</span>
                </span>
              </div>
            </div>
          </div>

          <!-- Benefits -->
          <div class="row mt-4">
            <div class="col-md-12">
              <label class="section-number-title-section mb-2">Benefits</label>
              <div class="row">
                <div
                  class="col-md-4 mb-3"
                  *ngFor="let benefit of benefits; let i = index">

                  <div class="d-flex justify-content-between align-items-center">
                    <div class="form-check">
                      <input
                        type="checkbox"
                        class="form-check-input"
                        [id]="'benefitCheck' + i"
                        [checked]="isEditCompanyBenefitChecked(benefit.id)"
                        (change)="onEditCompanyBenefitToggle(benefit.id, benefit.name, getCheckedValue($event))" />
                      <label class="form-check-label ms-1 title-info-data" [for]="'benefitCheck' + i">
                        {{ benefit.name }}
                      </label>
                    </div>

                    <input
                      *ngIf="isEditCompanyBenefitChecked(benefit.id)"
                      type="number"
                      class="form-control form-control-sm placeholder-input"
                      style="max-width: 80px;"
                      [value]="getEditCompanyBenefitPrice(benefit.id)"
                      (input)="onEditCompanyBenefitPriceChange(benefit.id, getInputValue($event))"
                      placeholder="$" />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn custom-btn" (click)="onSaveCompanyChanges()">Update Company</button>
        <button type="button" class="btn btn-secondary custom-btn-return" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Show Company -->
<div class="modal fade" id="showCompanyModal" tabindex="-1" aria-labelledby="showCompanyModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="showCompanyModalLabel">
          <i class="bi bi-building me-2 icon-style"></i>
          <span class="section-title">Company Details</span>
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <div class="container">
          <div class="row">
            <!-- General Data -->
            <div class="col-md-4 mb-3">
              <label class="section-number-title-section">General Data</label>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-building"></i> Name:</label>
                <ng-container *ngIf="companyDetail?.name; else loading">
                  <span class="title-info-data">{{ companyDetail.name }}</span>
                </ng-container>
                <ng-template #loading>
                  <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                </ng-template>
              </div>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-geo"></i> Address:</label>
                <ng-container *ngIf="companyDetail; else loading">
                  <span class="title-info-data">{{ companyDetail.address || 'N/A' }}</span>
                </ng-container>
                <ng-template #loading>
                  <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                </ng-template>
              </div>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-credit-card-2-front"></i> DTC Plan ID:</label>
                <ng-container *ngIf="companyDetail; else loading">
                  <span class="title-info-data">{{ companyDetail.dtc_plan_id || 'N/A' }}</span>
                </ng-container>
                <ng-template #loading>
                  <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                </ng-template>
              </div>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-credit-card-2-front"></i> Group:</label>
                <ng-container *ngIf="companyDetail; else loading">
                  <span class="title-info-data">{{ companyDetail.group.name || 'N/A' }}</span>
                </ng-container>
                <ng-template #loading>
                  <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                </ng-template>
              </div>

              <div class="mt-3 d-flex align-items-center">
                <label class="title-info me-2 d-flex align-items-center">
                  <i class="bi bi-check-circle me-1"></i>
                  Status:
                </label>
                <ng-container *ngIf="companyDetail; else loading">
                  <div class="form-check form-switch mb-0">
                    <input class="form-check-input" type="checkbox" role="switch"
                           [checked]="companyDetail.is_active"
                           id="switchActiveCompany-{{ companyDetail.id }}"
                           (change)="onToggleActive($event, companyDetail, true)" />
                  </div>
                </ng-container>
                <ng-template #loading>
                  <span class="skeleton-loader" style="width: 100px; height: 15px; display: inline-block;"></span>
                </ng-template>
              </div>
            </div>

            <!-- Contact Info -->
            <div class="col-md-4 mb-3">
              <label class="section-number-title-section">Contact Info</label>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-person"></i> Contact Name:</label>
                <ng-container *ngIf="companyDetail; else loading">
                  <span class="title-info-data">{{ companyDetail.contact_name || 'N/A' }}</span>
                </ng-container>
                <ng-template #loading>
                  <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                </ng-template>
              </div>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-envelope"></i> Contact Email:</label>
                <ng-container *ngIf="companyDetail; else loading">
                  <span class="title-info-data">{{ companyDetail.contact_email || 'N/A' }}</span>
                </ng-container>
                <ng-template #loading>
                  <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                </ng-template>
              </div>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-telephone"></i> Contact Phone:</label>
                <ng-container *ngIf="companyDetail; else loading">
                  <span class="title-info-data">{{ companyDetail.contact_phone || 'N/A' }}</span>
                </ng-container>
                <ng-template #loading>
                  <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                </ng-template>
              </div>
            </div>

            <!-- Billing Info -->
            <div class="col-md-4 mb-3">
              <label class="section-number-title-section">Billing Info</label>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-geo"></i> Billing Address:</label>
                <ng-container *ngIf="companyDetail; else loading">
                  <span class="title-info-data">{{ companyDetail.billing_address || 'N/A' }}</span>
                </ng-container>
                <ng-template #loading>
                  <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                </ng-template>
              </div>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-person"></i> Billing Contact Name:</label>
                <ng-container *ngIf="companyDetail; else loading">
                  <span class="title-info-data">{{ companyDetail.contact_billing || 'N/A' }}</span>
                </ng-container>
                <ng-template #loading>
                  <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                </ng-template>
              </div>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-envelope"></i> Billing Email:</label>
                <ng-container *ngIf="companyDetail; else loading">
                  <span class="title-info-data">{{ companyDetail.billing_email || 'N/A' }}</span>
                </ng-container>
                <ng-template #loading>
                  <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                </ng-template>
              </div>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-telephone"></i> Billing Phone:</label>
                <ng-container *ngIf="companyDetail; else loading">
                  <span class="title-info-data">{{ companyDetail.billing_phone || 'N/A' }}</span>
                </ng-container>
                <ng-template #loading>
                  <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                </ng-template>
              </div>
            </div>
          </div>

          <!-- Accounts Info -->
          <div class="row mt-3">
            <div class="col-md-6">
              <label class="section-number-title-section mb-2">Accounts Info</label>

              <ng-container *ngIf="companyDetail?.admin_accounts !== undefined; else loadingAccounts">
                <div *ngIf="companyDetail?.admin_accounts && companyDetail.admin_accounts.length > 0; else noAccounts">
                  <ul class="list-unstyled">
                    <li *ngFor="let account of companyDetail.admin_accounts" class="d-flex align-items-center mb-3">
                      <div class="d-flex align-items-center">
                        <div class="rounded-circle d-flex justify-content-center align-items-center"
                             style="width: 32px; height: 32px; background-color: #007bff; color: white; font-size: 20px;">
                          <i class="bi bi-person"></i>
                        </div>
                        <div class="ms-3">
                          <div class="account-text">{{ account.name }}</div>
                          <div class="account-text">{{ account.email }}</div>
                        </div>
                      </div>
                    </li>
                  </ul>
                </div>
                <ng-template #noAccounts>
                  <p class="no-accounts mt-2">
                    <i class="bi bi-person-x"></i>
                    No accounts available.
                  </p>
                </ng-template>
              </ng-container>

              <ng-template #loadingAccounts>
                <span class="skeleton-loader" style="width: 200px; height: 15px; display: inline-block;"></span>
              </ng-template>
            </div>

            <!-- Tags -->
            <div class="col-md-6">
              <label class="section-number-title-section">Tags</label>
              <ng-container *ngIf="companyDetail?.tags?.length; else noTags">
                <div class="tags-container d-flex flex-wrap gap-2 mt-2">
                  <span *ngFor="let tag of companyDetail.tags" class="tag-chip badge bg-primary rounded-pill text-white" style="padding: 0.5rem 1rem; font-size: 0.9rem;">
                    {{ tag.name }}
                  </span>
                </div>
              </ng-container>
              <ng-template #noTags>
                <p class="no-accounts mt-2">
                  <i class="bi bi-tag"></i>
                  No tags available.
                </p>
              </ng-template>
            </div>
          </div>

          <!-- Benefits -->
          <div class="row mt-4">
            <div class="col-md-12">
              <label class="section-number-title-section mb-2">Benefits</label>
              <div *ngIf="companyDetail?.benefits && companyDetail.benefits.length > 0">
                <div class="row">
                  <div class="col-md-4 mb-3" *ngFor="let b of companyDetail.benefits">
                    <div class="d-flex justify-content-between align-items-center">
                      <span class="title-info-data">{{ b.name }}</span>
                      <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch"
                               [checked]="b.enabled"
                               id="switchCheckCompanyBenefit-{{ b.id }}"
                               disabled/>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Members -->
          <div class="row mt-3" *ngIf="companyDetail?.members.length > 0">
            <div class="col-md-12">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <label class="section-number-title-section mb-0 d-flex align-items-center">
                  <i class="bi bi-people me-2 icon-style"></i>
                  Members
                </label>

                <div style="width: 50%;">
                  <div class="input-group">
                    <input type="text" class="form-control placeholder-input"
                           placeholder="Example: Member A"
                           [(ngModel)]="searchTermMember"
                           (keyup.enter)="searchMembers()"
                           aria-label="Search by Name"
                           aria-describedby="button-addon2"/>

                    <button class="btn btn-outline-secondary"
                            type="button"
                            id="button-addon2"
                            (click)="searchMembers()">
                      <i class="bi bi-search"></i>
                      <span class="search-btn">Search</span>
                    </button>
                  </div>
                </div>
              </div>

              <table class="table text-center mt-4">
                <thead>
                <tr>
                  <th scope="col" class="text-start">
                    <div class="d-flex align-items-center">
                      <span class="section-number-title">Name</span>
                    </div>
                  </th>
                  <th scope="col" class="text-start">
                    <span class="section-number-title">Email</span>
                  </th>
                  <th scope="col" class="text-start">
                    <span class="section-number-title">Phone</span>
                  </th>
                  <th scope="col">
                    <span class="section-number-title">Status</span>
                  </th>
                </tr>
                </thead>

                <tbody>
                <tr *ngFor="let member of paginatedMembers">
                  <th scope="row" class="text-start">
                    <span class="section-number-data">
                      {{ member?.name || 'Unknown' }}
                    </span>
                  </th>
                  <td class="text-start">
                    <span class="section-number-data">
                      {{ member?.contact_email || 'N/A' }}
                    </span>
                  </td>
                  <td class="text-start">
                    <span class="section-number-data">
                      {{ member?.contact_phone || 'N/A' }}
                    </span>
                  </td>
                  <td>
                    <div class="form-check form-switch d-flex justify-content-center">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        role="switch"
                        [checked]="member.is_active"
                        id="switchCompany-{{ member.id }}"
                        (change)="onToggleCompanyMemberStatus($event, member)"/>
                    </div>
                  </td>
                </tr>
                </tbody>
              </table>

              <nav *ngIf="filteredMembers && filteredMembers.length > membersPerPage" class="mt-4">
                <ul class="pagination justify-content-center">
                  <li class="page-item" [class.disabled]="currentMembersPage === 1">
                    <a class="page-link nav-btn" (click)="changeMemberPage(currentMembersPage - 1)">Prev</a>
                  </li>

                  <li class="page-item"
                      *ngFor="let page of [].constructor(Math.ceil((filteredMembers?.length || 0) / membersPerPage)); let i = index"
                      [class.active]="currentMembersPage === i + 1">
                    <a class="page-link nav-btn" (click)="changeMemberPage(i + 1)">{{ i + 1 }}</a>
                  </li>

                  <li class="page-item"
                      [class.disabled]="currentMembersPage === Math.ceil((filteredMembers?.length || 0) / membersPerPage)">
                    <a class="page-link nav-btn" (click)="changeMemberPage(currentMembersPage + 1)">Next</a>
                  </li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary custom-btn-return" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Remove Company -->
<div class="modal fade" id="removeCompanyModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          <i class="bi bi-collection me-2 icon-style"></i>
          <span class="section-title">Remove Company</span>
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body text-center d-flex flex-column align-items-center justify-content-center">
        <i class="bi bi-exclamation-octagon" style="font-size: 48px; color: #dc3545;"></i>
        <p class="want-delete mt-3">
          Are you sure you want to delete company <strong>{{ companyToRemove?.name }}</strong>?
        </p>
      </div>


      <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="deleteCompany()">
          <i class="bi bi-trash"></i>
          Remove
        </button>
        <button type="button" class="btn btn-secondary custom-btn-return" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

