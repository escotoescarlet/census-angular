<app-messages [show]="showMsg" [message]="messageInfo" [type]="typeMessage"></app-messages>

<div class="row justify-content-center">
  <div class="col-md-11 d-flex align-items-center">
    <i class="bi bi-collection me-2 icon-style"></i>
    <span class="section-title">Groups</span>
  </div>
</div>

<div class="row justify-content-center mt-2">
  <div class="col-11 d-flex justify-content-between align-items-center">

    <!-- Input de búsqueda al extremo izquierdo con ancho tipo col-6 -->
    <div style="width: 50%;">
      <div class="input-group">
        <input
          type="text"
          class="form-control placeholder-input"
          placeholder="Example: Group A"
          [(ngModel)]="searchTerm"
          aria-label="Search by Name"
          aria-describedby="button-addon2"
        />
        <button class="btn btn-outline-secondary" type="button" id="button-addon2" (click)="getGroups(1)">
          <i class="bi bi-search"></i>
          <span class="search-btn">Search</span>
        </button>
      </div>
    </div>

    <!-- Botón al extremo derecho -->
    <div>
        <button type="button" class="btn custom-btn" data-bs-toggle="modal" data-bs-target="#addGroupModal">
            <i class="bi bi-plus-circle"></i>
            New Group
        </button>
    </div>

  </div>
</div>

<div class="row justify-content-center table-row">
  <div class="col-md-11">
    <table class="table text-center">
      <thead>
        <tr>
            <th scope="col" class="text-start">
                <div class="d-flex align-items-center">
                    <span class="section-number-title">Name</span>
                    <button type="button" class="btn btn-link p-0 ms-2" (click)="toggleSortDirection()">
                        <i class="bi" [ngClass]="{
                            'bi-arrow-up': direction === 'asc',
                            'bi-arrow-down': direction === 'desc'
                        }"></i>
                    </button>
                </div>
            </th>
            <th scope="col" class="text-start">
                <span class="section-number-title">Companies</span>
            </th>
            <th scope="col" class="text-start">
                <span class="section-number-title">Status</span>
            </th>
            <th scope="col">
                <span class="section-number-title">Actions</span>
            </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let group of groups">
            <th scope="row" class="text-start">
                <span class="section-number-data">
                    {{ group.name }}
                </span>
            </th>
            <td class="text-start">
                <span class="section-number-data">
                    {{ group.companies_count }}
                </span>
            </td>
          <td class="text-start">
            <ng-container *ngIf="user.almost_rw_group_permissions; else readonlyGroupStatus">
              <div class="form-check form-switch d-flex align-items-center">
                <input
                  class="form-check-input"
                  type="checkbox"
                  role="switch"
                  [checked]="group.is_active"
                  id="switchCheckChecked-{{ group.id }}"
                  (change)="onToggleActive($event, group, false)"
                  title="Toggle active status"/>
                <label
                  class="form-check-label ms-2"
                  [for]="'switchCheckChecked-' + group.id">
                  <span class="section-number-data">Active</span>
                </label>
              </div>
            </ng-container>

            <ng-template #readonlyGroupStatus>
              <span class="section-number-data">
                {{ group.is_active ? 'Active' : 'Inactive' }}
              </span>
            </ng-template>
          </td>
          <td>
                <button *ngIf="user.almost_rw_group_permissions" type="button" (click)="downloadGroupMembersCsv(group.id)" class="btn btn-link">
                    <i class="bi bi-filetype-csv"></i>
                </button>

                <button type="button" (click)="showDetails(group)" class="btn btn-link" data-bs-toggle="modal" data-bs-target="#showGroupModal">
                    <i class="bi bi-eye"></i>
                </button>

                <button *ngIf="user.almost_rw_group_permissions" type="button" (click)="prepareEditGroup(group)" class="btn btn-link" data-bs-toggle="modal" data-bs-target="#editGroupModal">
                    <i class="bi bi-pencil text-success"></i>
                </button>

                <button *ngIf="user.almost_rw_group_permissions" type="button" (click)="readyToRemove(group)" class="btn btn-link" data-bs-toggle="modal" data-bs-target="#removeGroupModal">
                    <i class="bi bi-trash3 text-danger"></i>
                </button>
            </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<nav *ngIf="totalPages > 1" aria-label="Group pagination" class="mt-3 d-flex justify-content-center">
  <ul class="pagination">
    <li class="page-item" [class.disabled]="currentPage === 1">
      <button class="page-link directions-btn" (click)="goToPage(currentPage - 1)">Previous</button>
    </li>

    <li
      class="page-item"
      *ngFor="let page of [].constructor(totalPages); let i = index"
      [class.active]="i + 1 === currentPage">
        <button class="page-link directions-btn" (click)="goToPage(i + 1)">
            {{ i + 1 }}
        </button>
    </li>

    <li class="page-item" [class.disabled]="currentPage === totalPages">
      <button class="page-link directions-btn" (click)="goToPage(currentPage + 1)">Next</button>
    </li>
  </ul>
</nav>

<!-- Modal Create Group -->
<div class="modal fade" id="addGroupModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <form [formGroup]="groupForm" (ngSubmit)="onSubmitCreate()">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">
            <i class="bi bi-collection me-2 icon-style"></i>
            <span class="section-title">New Group</span>
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <div class="container">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label class="section-number-title-section">General Data</label>

                    <div>
                        <label class="section-number-title-light mt-2">Name</label>
                        <input
                            formControlName="name"
                            type="text"
                            class="form-control placeholder-input"
                            [ngClass]="{
                            'is-invalid': groupForm.get('name')?.touched && groupForm.get('name')?.invalid
                            }"
                            required
                        />
                        <div class="invalid-feedback" *ngIf="groupForm.get('name')?.touched && groupForm.get('name')?.invalid">
                            <span class="error-text">Group Name is required.</span>
                        </div>
                    </div>

                    <label class="section-number-title-section mt-4">Contact Info</label>

                    <div class="section-number-title-light mt-2">
                        <label class="mb-1">Address</label>
                        <input formControlName="address" type="text" class="form-control placeholder-input">
                    </div>

                    <div class="section-number-title-light mt-2">
                        <label class="mb-1">Contact Name</label>
                        <input
                            formControlName="contact_name"
                            type="text"
                            class="form-control placeholder-input"
                            [ngClass]="{
                            'is-invalid': groupForm.get('contact_name')?.touched && groupForm.get('contact_name')?.invalid
                            }"
                        />
                        <div class="invalid-feedback" *ngIf="groupForm.get('contact_name')?.touched && groupForm.get('contact_name')?.invalid">
                            <span class="error-text">Contact Name is required.</span>
                        </div>
                    </div>

                    <div class="section-number-title-light mt-2">
                        <label class="mb-1">Contact Email</label>
                        <input
                            formControlName="contact_email"
                            type="email"
                            class="form-control placeholder-input"
                            [ngClass]="{
                            'is-invalid': groupForm.get('contact_email')?.touched && groupForm.get('contact_email')?.invalid
                            }"
                        />
                        <div class="invalid-feedback" *ngIf="groupForm.get('contact_email')?.touched && groupForm.get('contact_email')?.errors as errors">
                            <span *ngIf="errors['required']">Contact Email is required.</span>
                            <span *ngIf="errors['email']">Invalid email format.</span>
                        </div>
                    </div>

                    <div class="section-number-title-light mt-2">
                        <label class="mb-1">Contact Phone</label>
                        <input formControlName="contact_phone" type="text" class="form-control placeholder-input">
                    </div>

                </div>

                <div class="col-md-4 mb-3">
                    <label class="section-number-title-section">Accounts Info</label>

                    <div class="section-number-title-light mt-2">
                        <label>Primary Name</label>
                        <input formControlName="primary_name" type="text" class="form-control placeholder-input"/>
                    </div>

                    <div class="section-number-title-light mt-2">
                        <label>Primary Email</label>
                        <input
                            formControlName="primary_email"
                            type="email"
                            class="form-control placeholder-input"
                            [ngClass]="{ 'is-invalid': groupForm.get('primary_email')?.touched && groupForm.get('primary_email')?.invalid }"
                        />
                        <div class="invalid-feedback" *ngIf="groupForm.get('primary_email')?.touched && groupForm.get('primary_email')?.errors as errors">
                            <span *ngIf="errors['email']">Invalid email format.</span>
                        </div>
                    </div>

                    <div class="section-number-title-light mt-2">
                        <label>Secondary Name</label>
                        <input formControlName="secondary_name" type="text" class="form-control placeholder-input">
                    </div>

                    <div class="section-number-title-light mt-2">
                        <label>Secondary Email</label>
                        <input formControlName="secondary_email" type="text" class="form-control placeholder-input">
                    </div>

                    <div class="section-number-title-light col-md-12 mt-3 d-flex align-items-center">
                        <input class="form-check-input me-2" type="checkbox" id="activeSwitch" formControlName="is_active">
                        <label class="form-check-label" for="activeSwitch">Active?</label>
                    </div>
                </div>

                <div class="col-md-4 mb-3">
                    <label class="section-number-title-section">Billing Info</label>

                    <div class="section-number-title-light mt-2">
                        <label>Billing Address</label>
                        <input formControlName="billing_address" type="text" class="form-control placeholder-input">
                    </div>

                    <div class="section-number-title-light mt-2">
                        <label>Billing Contact Name</label>
                        <input formControlName="billing_contact_name" type="text" class="form-control placeholder-input">
                    </div>

                    <div class="section-number-title-light mt-2">
                        <label>Billing Phone</label>
                        <input formControlName="billing_phone" type="text" class="form-control placeholder-input">
                    </div>

                    <div class="section-number-title-light mt-2">
                        <label>Billing Email</label>
                        <input formControlName="billing_email" type="text" class="form-control placeholder-input">
                    </div>
                </div>

            </div>

            <div class="col-md-12">
                <label class="section-number-title-section mb-4">Benefits</label>

                <div formArrayName="benefits">
                    <div class="row">
                    <div class="col-md-4 mb-1" *ngFor="let benefit of benefits; let i = index">
                        <div class="d-flex justify-content-between align-items-center">

                        <!-- Checkbox con nombre -->
                        <div class="form-check">
                            <input
                                type="checkbox"
                                class="form-check-input"
                                [formControlName]="i"
                                (change)="toggleBenefit(benefit.id, benefit.name, getCheckedValue($event))"
                                [id]="'benefitCheck' + i"/>
                                    <label class="form-check-label section-number-title-light ms-1" [for]="'benefitCheck' + i">
                                        {{ benefit.name }}
                                    </label>
                        </div>

                        <!-- Input visible solo si está activado -->
                        <input
                            *ngIf="groupForm.get('benefits')?.value[i]"
                            type="number"
                            class="form-control form-control-sm placeholder-input"
                            style="max-width: 80px;"
                            [value]="benefit.price"
                            (input)="updateBenefitPrice(benefit.id, getInputValue($event))"
                            placeholder="$"/>
                        </div>
                    </div>
                    </div>
                </div>
            </div>

          </div>
        </div>

        <div class="modal-footer">
            <button type="submit"
                    class="btn custom-btn d-flex align-items-center"
                    [disabled]="groupForm.invalid || isLoading">
                <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                {{ isLoading ? 'Saving...' : 'Save Group' }}
            </button>

            <button type="button" class="btn btn-secondary custom-btn-return" data-bs-dismiss="modal">Close</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal Show Group -->
<div class="modal fade" id="showGroupModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">

            <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">
                <i class="bi bi-collection me-2 icon-style"></i>
                <span class="section-title">
                    <ng-container *ngIf="groupDetail?.name; else loading">
                        {{ groupDetail.name }}
                    </ng-container>
                    <ng-template #loading>
                        <span class="skeleton-loader" style="width: 150px; height: 20px; display: inline-block;"></span>
                    </ng-template>
                </span>
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Modal Body Content -->
            <div class="modal-body">
                <div class="container">
                        <div class="row">

                        <!-- General Data -->
                        <div class="col-md-4 mb-3">
                            <label class="section-number-title-section">General Data</label>
                            <div class="mt-1">
                                <strong class="title-info">
                                    <i class="bi bi-collection"></i>
                                    Name:
                                </strong>

                                <ng-container *ngIf="groupDetail?.name; else loading">
                                    <span class="title-info-data">{{ groupDetail.name }}</span>
                                </ng-container>

                                <ng-template #loading>
                                    <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                                </ng-template>
                            </div>

                            <div class="mt-1">
                                <strong class="title-info">
                                    <i class="bi bi-envelope"></i>
                                    Contact Email:
                                </strong>
                                <ng-container *ngIf="groupDetail; else loading">
                                    <span class="title-info-data">
                                        {{ groupDetail.contact_email !== null && groupDetail.contact_email !== undefined ? groupDetail.contact_email : 'N/A' }}
                                    </span>
                                </ng-container>

                                <ng-template #loading>
                                    <span class="skeleton-loader" style="width: 140px; height: 15px; display: inline-block;"></span>
                                </ng-template>
                            </div>

                            <div class="mt-1">
                                <strong class="title-info">
                                    <i class="bi bi-telephone"></i>
                                    Contact Phone:
                                </strong>
                                <ng-container *ngIf="groupDetail; else loading">
                                    <span class="title-info-data">
                                        {{ groupDetail.contact_phone !== null && groupDetail.contact_phone !== undefined ? groupDetail.contact_phone : 'N/A' }}
                                    </span>
                                </ng-container>

                                <ng-template #loading>
                                    <span class="skeleton-loader" style="width: 100px; height: 15px; display: inline-block;"></span>
                                </ng-template>
                            </div>

                            <div class="mt-1">
                                <strong class="title-info">
                                    <i class="bi bi-geo"></i>
                                    Address:
                                </strong>
                                <ng-container *ngIf="groupDetail; else loading">
                                    <span class="title-info-data">
                                        {{ groupDetail.address !== null && groupDetail.address !== undefined ? groupDetail.address : 'N/A' }}
                                    </span>
                                </ng-container>

                                <ng-template #loading>
                                    <span class="skeleton-loader" style="width: 160px; height: 15px; display: inline-block;"></span>
                                </ng-template>
                            </div>

                            <div class="mt-1 d-flex align-items-center">
                                <strong class="title-info me-2 d-flex align-items-center">
                                    <i class="bi bi-check-circle me-1"></i>
                                    Status:
                                </strong>

                                <ng-container *ngIf="groupDetail !== null && groupDetail !== undefined; else loading">
                                    <div class="form-check form-switch mb-0">
                                        <input
                                            class="form-check-input"
                                            type="checkbox"
                                            role="switch"
                                            [checked]="groupDetail.is_active"
                                            id="switchCheckChecked-{{ groupDetail.id }}"
                                            (change)="onToggleActive($event, groupDetail, true)" />
                                    </div>
                                </ng-container>

                                <ng-template #loading>
                                    <span class="skeleton-loader" style="width: 100px; height: 15px; display: inline-block;"></span>
                                </ng-template>
                            </div>
                        </div>

                        <!-- Accounts Info -->
                        <div class="col-md-4 mb-3">
                            <label class="section-number-title-section mb-2">Accounts Info</label>

                            <ng-container *ngIf="groupDetail?.admin_accounts !== undefined; else loadingAccounts">
                                <div *ngIf="groupDetail?.admin_accounts?.length > 0; else noAccounts">
                                    <ul class="list-unstyled">
                                        <li *ngFor="let account of groupDetail.admin_accounts" class="d-flex align-items-center mb-3">
                                        <div class="rounded-circle d-flex justify-content-center align-items-center"
                                            style="width: 32px; height: 32px; background-color: #007bff; color: white; font-size: 20px;">
                                            <i class="bi bi-person"></i>
                                        </div>

                                        <div class="ms-3">
                                            <div class="account-text">{{ account.name }}</div>
                                            <div class="account-text">{{ account.email }}</div>
                                        </div>
                                        </li>
                                    </ul>
                                </div>

                                <ng-template #noAccounts>
                                    <p class="no-accounts mt-2">
                                        <i class="bi bi-person-x"></i>
                                        No accounts available.
                                    </p>
                                </ng-template>
                            </ng-container>

                            <ng-template #loadingAccounts>
                                <span class="skeleton-loader" style="width: 200px; height: 15px; display: inline-block;"></span>
                            </ng-template>
                        </div>

                        <!-- Billing Info -->
                        <div class="col-md-4 mb-3">
                            <label class="section-number-title-section">Billing Info</label>
                            <div class="mt-1">
                                <strong class="title-info">
                                    <i class="bi bi-envelope"></i>
                                    Billing Email:
                                </strong>
                                <ng-container *ngIf="groupDetail !== undefined; else loading">
                                    <span class="title-info-data">
                                    {{ groupDetail.billing_email ? groupDetail.billing_email : 'N/A' }}
                                    </span>
                                </ng-container>

                                <ng-template #loading>
                                    <span class="skeleton-loader" style="width: 140px; height: 15px; display: inline-block;"></span>
                                </ng-template>
                            </div>

                            <div class="mt-1">
                                <strong class="title-info">
                                    <i class="bi bi-telephone"></i>
                                    Billing Phone:
                                </strong>
                                <ng-container *ngIf="groupDetail !== undefined; else loading">
                                    <span class="title-info-data">
                                    {{ groupDetail.billing_phone ? groupDetail.billing_phone : 'N/A' }}
                                    </span>
                                </ng-container>

                                <ng-template #loading>
                                    <span class="skeleton-loader" style="width: 100px; height: 15px; display: inline-block;"></span>
                                </ng-template>
                            </div>

                            <div class="mt-1">
                                <strong class="title-info">
                                    <i class="bi bi-geo"></i>
                                    Billing Address:
                                </strong>

                                <ng-container *ngIf="groupDetail !== undefined; else loading">
                                    <span class="title-info-data">
                                    {{ groupDetail.billing_address ? groupDetail.billing_address : 'N/A' }}
                                    </span>
                                </ng-container>

                                <ng-template #loading>
                                    <span class="skeleton-loader" style="width: 160px; height: 15px; display: inline-block;"></span>
                                </ng-template>
                            </div>
                        </div>

                        <div class="row mt-3" *ngIf="groupDetail?.companies.length > 0">
                            <div class="col-md-12">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <!-- Título con ícono alineado a la izquierda -->
                                    <label class="section-number-title-section mb-0 d-flex align-items-center">
                                        <i class="bi bi-building me-2 icon-style"></i>
                                        Companies
                                    </label>

                                    <!-- Input de búsqueda alineado a la derecha -->
                                    <div style="width: 50%;">
                                        <div class="input-group">
                                            <input type="text" class="form-control placeholder-input"
                                                placeholder="Example: Company A"
                                                [(ngModel)]="searchTermCompanies"
                                                (keyup.enter)="searchCompanies()"
                                                aria-label="Search by Name"
                                                aria-describedby="button-addon2"/>

                                            <button class="btn btn-outline-secondary"
                                                type="button"
                                                id="button-addon2"
                                                (click)="searchCompanies()">
                                                    <i class="bi bi-search"></i>
                                                    <span class="search-btn">Search</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <table class="table text-center mt-4">
                                    <thead>
                                        <tr>
                                            <th scope="col" class="text-start">
                                                <div class="d-flex align-items-center">
                                                    <span class="section-number-title">Name</span>
                                                </div>
                                            </th>
                                            <th scope="col" class="text-start">
                                                <span class="section-number-title">Email</span>
                                            </th>
                                            <th scope="col" class="text-start">
                                                <span class="section-number-title">Phone</span>
                                            </th>
                                            <th scope="col">
                                                <span class="section-number-title">Status</span>
                                            </th>
                                        </tr>
                                    </thead>

                                    <tbody>
                                        <tr *ngFor="let company of paginatedCompanies">
                                            <th scope="row" class="text-start">
                                                <span class="section-number-data">
                                                    {{ company?.name ? company.name : 'Unknown'}}
                                                </span>
                                            </th>
                                            <td class="text-start">
                                                <span class="section-number-data">
                                                    {{ company?.contact_email ? company.contact_email : 'N/A' }}
                                                </span>
                                            </td>
                                            <td class="text-start">
                                                <span class="section-number-data">
                                                    {{ company?.contact_phone ? company?.contact_phone : 'N/A' }}
                                                </span>
                                            </td>
                                            <td>
                                                <div class="form-check form-switch d-flex justify-content-center">
                                                    <input
                                                        class="form-check-input"
                                                        type="checkbox"
                                                        role="switch"
                                                        [checked]="company.is_active"
                                                        id="switchCompany-{{ company.id }}"
                                                        (change)="onToggleGroupCompanyStatus($event, company)"/>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>

                                <nav *ngIf="filteredCompanies && filteredCompanies.length > companiesPerPage" class="mt-4">
                                    <ul class="pagination justify-content-center">
                                        <li class="page-item" [class.disabled]="currentCompanyPage === 1">
                                            <a class="page-link nav-btn" (click)="changeCompanyPage(currentCompanyPage - 1)">Prev</a>
                                        </li>

                                        <li class="page-item"
                                            *ngFor="let page of [].constructor(Math.ceil((filteredCompanies?.length || 0) / companiesPerPage)); let i = index"
                                            [class.active]="currentCompanyPage === i + 1">
                                            <a class="page-link nav-btn" (click)="changeCompanyPage(i + 1)">{{ i + 1 }}</a>
                                        </li>

                                        <li class="page-item" [class.disabled]="currentCompanyPage === Math.ceil((filteredCompanies?.length || 0) / companiesPerPage)">
                                            <a class="page-link nav-btn" (click)="changeCompanyPage(currentCompanyPage + 1)">Next</a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>

                        <!-- Benefits -->
                        <div class="row mt-3">
                            <div class="col-md-12">
                                <label class="section-number-title-section mb-2">Benefits</label>
                                <div *ngIf="groupDetail?.benefits?.length > 0">
                                    <div class="row">
                                        <div class="col-md-4 mb-3" *ngFor="let b of groupDetail.benefits">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <span class="title-info-data">{{ b.name }}</span>
                                                <div class="form-check form-switch">
                                                    <input
                                                        class="form-check-input"
                                                        type="checkbox"
                                                        role="switch"
                                                        [checked]="b.enabled"
                                                        id="switchCheckChecked-{{ b.id }}"
                                                        (change)="onToggleBenefit($event, b)" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary custom-btn-return" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Remove Group -->
<div class="modal fade" id="removeGroupModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
            <i class="bi bi-collection me-2 icon-style"></i>
            <span class="section-title">Remove Group</span>
          </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body text-center d-flex flex-column align-items-center justify-content-center">
        <i class="bi bi-exclamation-octagon" style="font-size: 48px; color: #dc3545;"></i>
        <p class="want-delete mt-3">
            Are you sure you want to delete group <strong>{{ groupToRemove?.name }}</strong>?
        </p>
      </div>


      <div class="modal-footer">
        <button type="button" class="btn btn-danger">
            <i class="bi bi-trash"></i>
            Remove
        </button>
        <button type="button" class="btn btn-secondary custom-btn-return" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Edit Group -->
<div class="modal fade" id="editGroupModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editModalLabel">
          <i class="bi bi-collection me-2 icon-style"></i>
          <span class="section-title">
            Edit Group
          </span>
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <!-- Modal Body Content -->
      <div class="modal-body">
        <div class="container">
          <div class="row">
            <!-- General Data -->
            <div class="col-md-4 mb-3">
              <label class="section-number-title-section">General Data</label>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-collection"></i> Name:</label>
                <input type="text" class="form-control mt-1 placeholder-input" [(ngModel)]="groupDetailEdit.name" />
              </div>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-envelope"></i> Contact Email:</label>
                <input type="email"
                    class="form-control mt-1 placeholder-input"
                    [(ngModel)]="groupDetailEdit.contact_email"
                    name="contact_email"
                    email
                    #contactEmail="ngModel"
                    [ngClass]="{ 'is-invalid': contactEmail.errors?.['email'] }"/>

                <div class="text-danger mt-1" *ngIf="contactEmail.errors?.['email'] && contactEmail.touched">
                    <span class="error-message">Enter a valid email address.</span>
                </div>
              </div>

              <div class="mt-3">
                <label class="title-info d-block">
                    <i class="bi bi-telephone"></i> Contact Phone:
                </label>

                <input
                    type="tel"
                    class="form-control mt-1 placeholder-input"
                    [(ngModel)]="groupDetailEdit.contact_phone"
                    name="contact_phone"
                    pattern="^\d{3}-\d{3}-\d{4}$"
                    #contactPhone="ngModel"
                    [ngClass]="{ 'is-invalid': contactPhone.errors?.['pattern'] }"/>

                <div class="text-danger mt-1" *ngIf="contactPhone.errors?.['pattern']">
                    <span class="error-message">Format must be: 555-555-5555</span>
                </div>
              </div>


              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-geo"></i> Address:</label>
                <input type="text" class="form-control mt-1 placeholder-input" [(ngModel)]="groupDetailEdit.address" />
              </div>

              <div class="mt-3 d-flex align-items-center">
                <label class="title-info me-2 d-flex align-items-center">
                  <i class="bi bi-check-circle me-1"></i>
                  Status:
                </label>
                <div class="form-check form-switch mb-0">
                  <input class="form-check-input" type="checkbox" role="switch"
                        [checked]="groupDetailEdit.is_active"
                        id="switchCheckChecked-{{ groupDetailEdit.id }}"
                        (change)="onToggleActive($event, groupDetailEdit, true)" />
                </div>
              </div>
            </div>

            <!-- Accounts Info -->
            <div class="col-md-4 mb-3">
                <label class="section-number-title-section mb-2">Accounts Info</label>

                <ng-container *ngIf="groupDetailEdit?.admin_accounts !== undefined; else loadingAccounts">
                    <div *ngIf="groupDetailEdit?.admin_accounts && groupDetailEdit.admin_accounts.length > 0; else noAccounts">
                        <ul class="list-unstyled">
                        <li *ngFor="let account of groupDetailEdit.admin_accounts" class="d-flex align-items-center justify-content-between mb-3">

                            <div class="d-flex align-items-center">
                                <div class="rounded-circle d-flex justify-content-center align-items-center"
                                    style="width: 32px; height: 32px; background-color: #007bff; color: white; font-size: 20px;">
                                    <i class="bi bi-person"></i>
                                </div>

                                <div class="ms-3">
                                    <div class="account-text">{{ account.name }}</div>
                                    <div class="account-text">{{ account.email }}</div>
                                </div>
                            </div>

                            <div>
                                <i class="bi bi-trash text-danger icon-right-space" (click)="removeAdminAccount(account)"></i>
                            </div>
                        </li>
                        </ul>
                    </div>

                    <ng-template #noAccounts>
                        <p class="no-accounts mt-2">
                        <i class="bi bi-person-x"></i>
                        No accounts available.
                        </p>
                    </ng-template>
                </ng-container>

                <ng-template #loadingAccounts>
                    <span class="skeleton-loader" style="width: 200px; height: 15px; display: inline-block;"></span>
                </ng-template>
            </div>

            <!-- Billing Info -->
            <div class="col-md-4 mb-3">
              <label class="section-number-title-section">Billing Info</label>

              <div class="mt-3">
                <label class="title-info d-block">
                    <i class="bi bi-envelope"></i> Billing Email
                </label>

                <input
                    type="email"
                    class="form-control mt-1 placeholder-input"
                    [(ngModel)]="groupDetailEdit.billing_email"
                    name="billing_email"
                    email
                    #billingEmail="ngModel"
                    [ngClass]="{ 'is-invalid': billingEmail.errors?.['email'] }"/>

                <div class="text-danger mt-1" *ngIf="billingEmail.errors?.['email']">
                    <span class="error-message">Enter a valid billing email address.</span>
                </div>
            </div>

            <div class="mt-3">
                <label class="title-info d-block">
                    <i class="bi bi-telephone"></i> Billing Phone
                </label>
                <input
                    type="tel"
                    class="form-control mt-1 placeholder-input"
                    [(ngModel)]="groupDetailEdit.billing_phone"
                    name="billing_phone"
                    pattern="^\d{3}-\d{3}-\d{4}$"
                    #billingPhone="ngModel"
                    [ngClass]="{ 'is-invalid': billingPhone.errors?.['pattern'] }"/>

                <div class="text-danger mt-1" *ngIf="billingPhone.errors?.['pattern']">
                    <span class="error-message">Format must be: 555-555-5555</span>
                </div>
            </div>

            <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-geo"></i> Billing Address</label>
                <input type="text" class="form-control mt-1 placeholder-input" [(ngModel)]="groupDetailEdit.billing_address" />
            </div>
            </div>
          </div>

          <!-- Companies Info -->
          <div class="row mt-3" *ngIf="isArrayAndNotEmpty(groupDetailEdit?.companies) && groupDetailEdit.companies.length > 0">
            <div class="col-md-12">
              <label class="section-number-title-section mb-0 d-flex align-items-center">
                <i class="bi bi-building me-2 icon-style"></i>
                Companies
              </label>

              <div class="input-group mt-2 mb-3" style="width: 50%;">
                <input type="text" class="form-control placeholder-input"
                       placeholder="Example: Company A"
                       [(ngModel)]="searchTermEditCompanies"
                       (keyup.enter)="searchCompaniesEdit()" />
                <button class="btn btn-outline-secondary" type="button" (click)="searchCompaniesEdit()">
                  <i class="bi bi-search"></i> <span class="search-btn">Search</span>
                </button>
              </div>

              <table class="table text-center mt-3">
                <thead>
                  <tr>
                    <th class="text-start section-number-title">Name</th>
                    <th class="text-start section-number-title">Email</th>
                    <th class="text-start section-number-title">Phone</th>
                    <th class="section-number-title">Status</th>
                  </tr>
                </thead>

                <tbody>
                  <tr *ngFor="let company of paginatedEditCompanies">
                    <td class="text-start">
                        <span class="section-number-data">{{ company.name ? company.name : 'N/A' }}</span>
                    </td>

                    <td class="text-start">
                        <span class="section-number-data">{{ company.contact_email ? company.contact_email : 'N/A' }}</span>
                    </td>

                    <td class="text-start">
                        <span class="section-number-data">{{ company.contact_phone ? company.contact_phone : 'N/A' }}</span>
                    </td>

                    <td>
                      <div class="form-check form-switch d-flex justify-content-center">
                        <input class="form-check-input" type="checkbox" role="switch"
                            [checked]="company.is_active"
                            id="switchCompany-{{ company.id }}"
                            (change)="onToggleGroupCompanyStatus($event, company)" />
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>

              <nav *ngIf="filteredCompaniesEdit && filteredCompaniesEdit.length > companiesEditPerPage" class="mt-4">
                <ul class="pagination justify-content-center">
                  <li class="page-item" [class.disabled]="currentCompanyEditPage === 1">
                    <a class="page-link nav-btn" (click)="changeCompanyEditPage(currentCompanyEditPage - 1)">Prev</a>
                  </li>
                  <li class="page-item"
                      *ngFor="let page of [].constructor(Math.ceil((filteredCompaniesEdit?.length || 0) / companiesEditPerPage)); let i = index"
                      [class.active]="currentCompanyEditPage === i + 1">
                    <a class="page-link nav-btn" (click)="changeCompanyEditPage(i + 1)">{{ i + 1 }}</a>
                  </li>
                  <li class="page-item" [class.disabled]="currentCompanyEditPage === Math.ceil((filteredCompaniesEdit?.length || 0) / companiesEditPerPage)">
                    <a class="page-link nav-btn" (click)="changeCompanyEditPage(currentCompanyEditPage + 1)">Next</a>
                  </li>
                </ul>
              </nav>
            </div>
          </div>

          <!-- Benefits Info -->
          <div class="row mt-3">
            <div class="col-md-12">
              <label class="section-number-title-section mb-2">Benefits</label>
              <div *ngIf="groupDetailEdit?.benefits && groupDetailEdit.benefits.length > 0">
                <div class="row">
                  <div class="col-md-4 mb-3" *ngFor="let b of groupDetailEdit.benefits">
                    <div class="d-flex justify-content-between align-items-center">
                      <span class="title-info-data">{{ b.name }}</span>
                      <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch"
                            [checked]="b.enabled"
                            id="switchCheckChecked-{{ b.id }}"
                            (change)="onToggleBenefitUpdate($event, b)" />
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer">
        <button type="button" class="btn custom-btn" (click)="onSaveChanges()">Update Group</button>
        <button type="button" class="btn btn-secondary custom-btn-return" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

