<app-messages [show]="showMsg" [message]="messageInfo" [type]="typeMessage"></app-messages>

<div class="row justify-content-center">
  <div class="col-md-11 d-flex align-items-center">
    <i class="bi bi-people me-2 icon-style"></i>
    <span class="section-title">Accounts</span>
  </div>
</div>

<div class="row justify-content-center mt-2">
  <div class="col-11 d-flex justify-content-between align-items-center">

    <!-- Input de búsqueda al extremo izquierdo con ancho tipo col-6 -->
    <div style="width: 50%;">
      <div class="input-group">
        <input
          type="text"
          class="form-control placeholder-input"
          placeholder="Example: John Doe or johndoe@email.com"
          [(ngModel)]="searchTerm"
          (keyup.enter)="searchAccounts()"
          aria-label="Search by Name"
          aria-describedby="button-addon2"/>
            <button class="btn btn-outline-secondary" type="button" id="button-addon2" (click)="searchAccounts(1)">
                <i class="bi bi-search"></i>
                <span class="search-btn">Search</span>
            </button>
      </div>
    </div>

    <!-- Botón al extremo derecho -->
    <div>
      <button type="button" class="btn custom-btn" data-bs-toggle="modal" data-bs-target="#addAccountModal">
        <i class="bi bi-plus-circle"></i>
        New Account
      </button>
    </div>
  </div>
</div>

<div class="row justify-content-center table-row">
  <div class="col-md-11">
    <table class="table text-center">
      <thead>
      <tr>
        <th scope="col" class="text-start">
          <div class="d-flex align-items-center">
            <span class="section-number-title">Name</span>
            <button type="button" class="btn btn-link p-0 ms-2" (click)="toggleSortDirection()">
              <i class="bi" [ngClass]="{
                            'bi-arrow-up': direction === 'asc',
                            'bi-arrow-down': direction === 'desc'
                        }"></i>
            </button>
          </div>
        </th>
        <th scope="col" class="text-start">
          <span class="section-number-title">Email</span>
        </th>
        <th scope="col" class="text-start">
          <span class="section-number-title">Created</span>
        </th>
        <th scope="col">
          <span class="section-number-title">Actions</span>
        </th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let account of accounts">
        <th scope="row" class="text-start">
          <span class="section-number-data">
            {{ account.name }}
          </span>
        </th>
        <td class="text-start">
            <span class="section-number-data">
                {{ account.email }}
            </span>
        </td>
        <td class="text-start">
            <span class="section-number-data">
                {{ account.created_at | date }}
            </span>
        </td>
        <td>
          <button type="button" (click)="showDetails(account)" class="btn btn-link" data-bs-toggle="modal"
                  data-bs-target="#showAccountModal">
            <i class="bi bi-eye"></i>
          </button>

          <button type="button" (click)="prepareEditCompany(account)" class="btn btn-link" data-bs-toggle="modal"
                  data-bs-target="#editCompanyModal">
            <i class="bi bi-pencil text-success"></i>
          </button>

          <button type="button" (click)="readyToRemove(account)" class="btn btn-link" data-bs-toggle="modal"
                  data-bs-target="#removeCompanyModal">
            <i class="bi bi-trash3 text-danger"></i>
          </button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<nav *ngIf="totalPages > 1" aria-label="Account pagination" class="mt-3 d-flex justify-content-center">
  <ul class="pagination">

    <!-- Previous -->
    <li class="page-item" [class.disabled]="currentPage === 1">
      <button class="page-link directions-btn" (click)="goToPage(currentPage - 1)">Previous</button>
    </li>

    <!-- First page -->
    <li class="page-item" [class.active]="currentPage === 1">
      <button class="page-link directions-btn" (click)="goToPage(1)">1</button>
    </li>

    <!-- Left ellipsis -->
    <li class="page-item disabled" *ngIf="currentPage > 4">
      <span class="page-link directions-btn">...</span>
    </li>

    <!-- Pages around current -->
    <li class="page-item"
      *ngFor="let page of getDisplayedPages()"
      [class.active]="currentPage === page">
        <button class="page-link directions-btn" (click)="goToPage(page)">
            {{ page }}
        </button>
    </li>

    <!-- Right ellipsis -->
    <li class="page-item disabled" *ngIf="currentPage < totalPages - 3">
      <span class="page-link directions-btn">...</span>
    </li>

    <!-- Last page -->
    <li class="page-item" [class.active]="currentPage === totalPages" *ngIf="totalPages > 1">
      <button class="page-link directions-btn" (click)="goToPage(totalPages)">
        {{ totalPages }}
      </button>
    </li>

    <!-- Next -->
    <li class="page-item" [class.disabled]="currentPage === totalPages">
      <button class="page-link directions-btn" (click)="goToPage(currentPage + 1)">Next</button>
    </li>
    
  </ul>
</nav>


<!-- Modal Show Account -->
<div class="modal fade" id="showAccountModal" tabindex="-1" aria-labelledby="showAccountModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="showAccountModalLabel">
          <i class="bi bi-people me-2 icon-style"></i>
          <span class="section-title">Account Details</span>
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <div class="container">
          <div class="row">
            <!-- General Data -->
            <div class="col-md-12 mb-3">
              <label class="section-number-title-section">General Data</label>

              <div class="row">
                <div class="col-md-4">
                    <div class="mt-3">
                        <label class="title-info d-block"><i class="bi bi-person"></i> Account Name</label>
                        <ng-container *ngIf="accountDetails?.name; else loading">
                            <span class="title-info-data">{{ accountDetails.name }}</span>
                        </ng-container>
                        <ng-template #loading>
                            <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                        </ng-template>
                    </div>

                    <div class="mt-3">
                        <label class="title-info d-block"><i class="bi bi-envelope"></i> Email</label>
                        <ng-container *ngIf="accountDetails; else loading">
                            <span class="title-info-data">{{ accountDetails.email || 'N/A' }}</span>
                        </ng-container>
                        <ng-template #loading>
                            <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                        </ng-template>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="mt-3">
                        <label class="title-info d-block"><i class="bi bi-calendar-event"></i> Created</label>
                        <ng-container *ngIf="accountDetails; else loading">
                            <span class="title-info-data">{{ accountDetails.created_at | date }}</span>
                        </ng-container>
                        <ng-template #loading>
                            <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                        </ng-template>
                    </div>

                    <div class="mt-3">
                        <label class="title-info d-block"><i class="bi bi-translate"></i> Languages</label>
                        <ng-container *ngIf="accountDetails; else loading">
                            <span class="title-info-data">{{ accountDetails?.user && accountDetails?.user?.preferred_language ? accountDetails?.user?.preferred_language : "English" }}</span>
                        </ng-container>
                        <ng-template #loading>
                            <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                        </ng-template>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="mt-3">
                        <label class="title-info d-block"><i class="bi bi-geo-alt"></i> Billing Address</label>
                        <ng-container *ngIf="accountDetails; else loading">
                            <span class="title-info-data">{{ accountDetails.billing_email || 'N/A' }}</span>
                        </ng-container>

                        <ng-template #loading>
                            <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                        </ng-template>
                    </div>

                    <div class="mt-3 d-flex align-items-center">
                        <strong class="title-info me-2 d-flex align-items-center">
                            <i class="bi bi-check-circle me-1"></i>
                            Superadmin
                        </strong>

                        <ng-container *ngIf="accountDetails !== null && accountDetails !== undefined; else loading">
                            <div class="form-check form-switch mb-0">
                                <input
                                    class="form-check-input"
                                    type="checkbox"
                                    role="switch"
                                    [checked]="accountDetails?.user?.admin"
                                    id="switchCheckChecked-{{ accountDetails.id }}"
                                    (change)="onToggleActiveSuperadmin($event, accountDetails)" />
                            </div>
                        </ng-container>

                        <ng-template #loading>
                            <span class="skeleton-loader" style="width: 100px; height: 15px; display: inline-block;"></span>
                        </ng-template>
                    </div>
                </div>
              </div>
            </div>

          <!-- Permissions -->
          <div class="row mt-4">
            <div class="col-md-12">
                <label class="section-number-title-section mb-2">Permissions</label>

                <div *ngIf="permissions && permissions.length > 0">
                    <div class="table-responsive">
                        <table class="table text-center">
                            <thead>
                                <tr>
                                    <th class="text-start section-number-title">Group or Company</th>
                                    <th class="section-number-title">Read</th>
                                    <th class="section-number-title">RW</th>
                                    <th class="section-number-title">Admin</th>
                                    <th class="section-number-title">Superadmin</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let b of permissions">
                                    <td class="text-start">
                                    <span class="section-number-data">{{ b.name }}</span>
                                    </td>

                                    <td>
                                    <div class="form-check form-switch d-flex justify-content-center">
                                        <input class="form-check-input" type="checkbox" role="switch"
                                        [checked]="b.read"
                                        id="switchCheckRead-{{ b.id }}"/>
                                    </div>
                                    </td>

                                    <td>
                                    <div class="form-check form-switch d-flex justify-content-center">
                                        <input class="form-check-input" type="checkbox" role="switch"
                                        [checked]="b.rw"
                                        id="switchCheckRW-{{ b.id }}"/>
                                    </div>
                                    </td>

                                    <td>
                                    <div class="form-check form-switch d-flex justify-content-center">
                                        <input class="form-check-input" type="checkbox" role="switch"
                                        [checked]="b.admin"
                                        id="switchCheckAdmin-{{ b.id }}"/>
                                    </div>
                                    </td>

                                    <td>
                                    <div class="form-check form-switch d-flex justify-content-center">
                                        <input class="form-check-input" type="checkbox" role="switch"
                                        [checked]="b.superadmin"
                                        id="switchCheckSuperadmin-{{ b.id }}"/>
                                    </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div *ngIf="permissions && permissions.length == 0"
                    class="text-center d-flex flex-column align-items-center justify-content-center"
                    style="min-height: 150px;">
                    <i class="bi bi-inbox icon-style-no-permissions"></i>
                    <span class="mt-2 no-permissions-available">No permissions available</span>
                </div>
            </div>

            <nav *ngIf="permissions.length > 0 && paginationShow?.total && paginationShow.total > 1" aria-label="Account pagination" class="mt-3 d-flex justify-content-center">
                <ul class="pagination">
                    <!-- Previous -->
                    <li class="page-item" [class.disabled]="paginationShow?.current === 1">
                        <button class="page-link directions-btn" (click)="goToPageShow(paginationShow?.current - 1)">Previous</button>
                    </li>

                    <!-- First page -->
                    <li class="page-item" [class.active]="paginationShow?.current === 1">
                        <button class="page-link directions-btn" (click)="goToPageShow(1)">1</button>
                    </li>

                    <!-- Left ellipsis -->
                    <li class="page-item disabled" *ngIf="paginationShow?.current > 4">
                        <span class="page-link directions-btn">...</span>
                    </li>

                    <!-- Pages around current -->
                    <li class="page-item"
                        *ngFor="let pageshow of getDisplayedCurrentPages()"
                        [class.active]="paginationShow?.current === pageshow">
                            <button class="page-link directions-btn" (click)="goToPageShow(pageshow)">
                                {{ pageshow }}
                            </button>
                    </li>

                    <!-- Right ellipsis -->
                    <li class="page-item disabled" *ngIf="paginationShow?.current < paginationShow?.total - 3">
                        <span class="page-link directions-btn">...</span>
                    </li>

                    <!-- Last page -->
                    <li class="page-item" [class.active]="paginationShow?.current === paginationShow?.total" *ngIf="paginationShow?.total > 1">
                        <button class="page-link directions-btn" (click)="goToPageShow(paginationShow?.total)">
                            {{ paginationShow.total }}
                        </button>
                    </li>

                    <!-- Next -->
                    <li class="page-item" [class.disabled]="paginationShow?.current === paginationShow?.total">
                        <button class="page-link directions-btn" (click)="goToPageShow(paginationShow?.current + 1)">Next</button>
                    </li>
                </ul>
            </nav>

          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary custom-btn-return" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

