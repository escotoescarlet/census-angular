<app-messages [show]="showMsg" [message]="messageInfo" [type]="typeMessage"></app-messages>

<div class="row justify-content-center">
  <div class="col-md-11 d-flex align-items-center">
    <i class="bi bi-collection me-2 icon-style"></i>
    <span class="section-title">Tags</span>
  </div>
</div>

<div class="row justify-content-center mt-2">
  <div class="col-11 d-flex justify-content-between align-items-center">

    <!-- Input de búsqueda -->
    <div style="width: 50%;">
      <div class="input-group">
        <input
          type="text"
          class="form-control placeholder-input"
          placeholder="Example: Tag A"
          [(ngModel)]="searchTerm"
          aria-label="Search by Name"
          aria-describedby="button-addon2"
        />
        <button class="btn btn-outline-secondary" type="button" id="button-addon2" (click)="getTags(1)">
          <i class="bi bi-search"></i>
          <span class="search-btn">Search</span>
        </button>
      </div>
    </div>

    <!-- Botón Nuevo Tag -->
    <div>
      <button type="button" class="btn custom-btn" data-bs-toggle="modal" data-bs-target="#addTagModal">
        <i class="bi bi-plus-circle"></i>
        New Tag
      </button>
    </div>
  </div>
</div>

<div class="row justify-content-center table-row">
  <div class="col-md-11">
    <table class="table text-center">
      <thead>
      <tr>
        <th scope="col" class="text-start">
          <div class="d-flex align-items-center">
            <span class="section-number-title">Name</span>
            <button type="button" class="btn btn-link p-0 ms-2" (click)="toggleSortDirection()">
              <i class="bi" [ngClass]="{
                      'bi-arrow-up': direction === 'asc',
                      'bi-arrow-down': direction === 'desc'
                  }"></i>
            </button>
          </div>
        </th>
        <th scope="col">
          <span class="section-number-title">Actions</span>
        </th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let tag of tags">
        <th scope="row" class="text-start">
          <span class="section-number-data">{{ tag.name }}</span>
        </th>
        <td>
          <button type="button" (click)="prepareEditTag(tag)" class="btn btn-link" data-bs-toggle="modal" data-bs-target="#editTagModal">
            <i class="bi bi-pencil text-success"></i>
          </button>

          <button type="button" (click)="readyToRemove(tag)" class="btn btn-link" data-bs-toggle="modal" data-bs-target="#removeTagModal">
            <i class="bi bi-trash3 text-danger"></i>
          </button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<nav *ngIf="totalPages > 1" aria-label="Account pagination" class="mt-3 d-flex justify-content-center">
  <ul class="pagination">

    <!-- Previous -->
    <li class="page-item" [class.disabled]="currentPage === 1">
      <button class="page-link directions-btn" (click)="goToPage(currentPage - 1)">Previous</button>
    </li>

    <!-- First page -->
    <li class="page-item" [class.active]="currentPage === 1">
      <button class="page-link directions-btn" (click)="goToPage(1)">1</button>
    </li>

    <!-- Left ellipsis -->
    <li class="page-item disabled" *ngIf="currentPage > 4">
      <span class="page-link directions-btn">...</span>
    </li>

    <!-- Pages around current -->
    <li class="page-item" *ngFor="let page of getDisplayedPages()" [class.active]="currentPage === page">
      <button class="page-link directions-btn" (click)="goToPage(page)">{{ page }}</button>
    </li>

    <!-- Right ellipsis -->
    <li class="page-item disabled" *ngIf="currentPage < totalPages - 3">
      <span class="page-link directions-btn">...</span>
    </li>

    <!-- Last page -->
    <li class="page-item" [class.active]="currentPage === totalPages" *ngIf="totalPages > 1">
      <button class="page-link directions-btn" (click)="goToPage(totalPages)">{{ totalPages }}</button>
    </li>

    <!-- Next -->
    <li class="page-item" [class.disabled]="currentPage === totalPages">
      <button class="page-link directions-btn" (click)="goToPage(currentPage + 1)">Next</button>
    </li>

  </ul>
</nav>

<!-- Modal Create Tag -->
<div class="modal fade" id="addTagModal" tabindex="-1" aria-labelledby="addTagModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <form [formGroup]="tagForm" (ngSubmit)="onSubmitCreate()">
        <div class="modal-header">
          <h5 class="modal-title" id="addTagModalLabel">
            <i class="bi bi-tags me-2 icon-style"></i>
            <span class="section-title">New Tag</span>
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <div class="container">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="section-number-title-section">Name</label>
                <input type="text" formControlName="name" class="form-control mt-1 placeholder-input"
                       [ngClass]="{ 'is-invalid': tagForm.get('name')?.touched && tagForm.get('name')?.invalid }" />
                <div class="invalid-feedback" *ngIf="tagForm.get('name')?.touched && tagForm.get('name')?.invalid">
                  <span class="error-text">Name is required.</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn btn-primary custom-btn d-flex align-items-center" [disabled]="tagForm.invalid || isLoading">
            <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
            {{ isLoading ? 'Saving...' : 'Save Tag' }}
          </button>
          <button type="button" class="btn btn-secondary custom-btn-return" data-bs-dismiss="modal">Close</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal Edit Tag -->
<div class="modal fade" id="editTagModal" tabindex="-1" aria-labelledby="editTagModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <form [formGroup]="tagForm" (ngSubmit)="onSaveTagChanges()">
        <div class="modal-header">
          <h5 class="modal-title" id="editTagModalLabel">
            <i class="bi bi-tags me-2 icon-style"></i>
            <span class="section-title">Update Tag</span>
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <div class="container">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="section-number-title-section">Name</label>
                <input type="text" formControlName="name" class="form-control mt-1 placeholder-input"
                       [ngClass]="{ 'is-invalid': tagForm.get('name')?.touched && tagForm.get('name')?.invalid }" />
                <div class="invalid-feedback" *ngIf="tagForm.get('name')?.touched && tagForm.get('name')?.invalid">
                  <span class="error-text">Name is required.</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn btn-primary custom-btn d-flex align-items-center" [disabled]="tagForm.invalid || isLoading">
            <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
            {{ isLoading ? 'Saving...' : 'Save Tag' }}
          </button>
          <button type="button" class="btn btn-secondary custom-btn-return" data-bs-dismiss="modal">Close</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal Remove Tag -->
<div class="modal fade" id="removeTagModal" tabindex="-1" aria-labelledby="removeTagModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="removeTagModalLabel">
          <i class="bi bi-tags me-2 icon-style"></i>
          <span class="section-title">Remove Tag</span>
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body text-center d-flex flex-column align-items-center justify-content-center">
        <i class="bi bi-exclamation-octagon" style="font-size: 48px; color: #dc3545;"></i>
        <p class="want-delete mt-3">
          Are you sure you want to delete tag <strong>{{ tagToRemove?.name }}</strong>?
        </p>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="deleteTag()">
          <i class="bi bi-trash"></i>
          Remove
        </button>
        <button type="button" class="btn btn-secondary custom-btn-return" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
