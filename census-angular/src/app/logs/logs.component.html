<app-messages [show]="showMsg" [message]="messageInfo" [type]="typeMessage"></app-messages>

<app-messages [show]="showMsg" [message]="messageInfo" [type]="typeMessage"></app-messages>

<!-- Título -->
<div class="row justify-content-center">
  <div class="col-md-11 d-flex align-items-center">
    <i class="bi bi-collection me-2 icon-style"></i>
    <span class="section-title">Logs</span>
  </div>
</div>

<!-- Búsqueda -->
<!--<div class="row justify-content-center mt-2">
  <div class="col-md-11">
    <div class="input-group">
      <input
        type="text"
        class="form-control placeholder-input"
        placeholder="Example: Some text"
        [(ngModel)]="searchTerm"
        aria-label="Search"
        aria-describedby="button-addon2"
      />
      <button class="btn btn-outline-secondary" type="button" id="button-addon2" (click)="loadLogs(1)">
        <i class="bi bi-search"></i>
        <span class="search-btn">Search</span>
      </button>
    </div>
  </div>
</div>-->

<!-- Filtros -->
<div class="row justify-content-center mt-3">
  <div class="col-md-11">
    <div class="row g-2">
      <div class="col-md-3">
        <select class="form-select" [(ngModel)]="groupId" (change)="onGroupChange()">
          <option value="">All Groups</option>
          <option *ngFor="let g of groups" [value]="g.id">{{ g.name }}</option>
        </select>
      </div>
      <div class="col-md-3">
        <select class="form-select" [(ngModel)]="companyId" (change)="onCompanyChange()">
          <option value="">All Companies</option>
          <option *ngFor="let c of companies" [value]="c.id">{{ c.name }}</option>
        </select>
      </div>
      <div class="col-md-3">
        <select class="form-select" [(ngModel)]="memberId" (change)="onMemberChange()">
          <option value="">All Members</option>
          <option *ngFor="let m of members" [value]="m.id">{{ m.first }} {{ m.last }}</option>
        </select>
      </div>
    </div>
  </div>
</div>

<!-- Tabla -->
<div class="row justify-content-center table-row">
  <div class="col-md-11">
    <table class="table table-hover align-middle">
      <thead>
      <tr>
        <th class="text-start" style="width: 15%;">
          <div class="d-flex align-items-center">
            <span class="section-number-title">User</span>
            <button type="button" class="btn btn-link p-0 ms-2" (click)="toggleSortDirection()">
              <i class="bi" [ngClass]="{
                  'bi-arrow-up': direction === 'asc',
                  'bi-arrow-down': direction === 'desc'
                }"></i>
            </button>
          </div>
        </th>
        <th class="text-start" style="width: 15%;">
          <span class="section-number-title">Event</span>
        </th>
        <th style="width: 15%;">
          <span class="section-number-title">Item Type</span>
        </th>
        <th style="width: 35%;" class="text-start">
          <span class="section-number-title">Changes</span>
        </th>
        <th style="width: 20%;" class="text-start">
          <span class="section-number-title">Date</span>
        </th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let log of logs">
        <td class="text-start">
          <span class="section-number-data">{{ log.whodunnit }}</span>
        </td>
        <td class="text-start">
          <span class="section-number-data">{{ log.event }}</span>
        </td>
        <td class="text-start">
          <span class="section-number-data">{{ log.item_type }}</span>
        </td>
        <td class="text-start" style="white-space: pre-wrap; word-break: break-word;">
          <div style="max-height: 15em; overflow-y: auto;">
            <span class="section-number-data">{{ log.object }}</span>
          </div>
        </td>
        <td class="text-start">
          <span class="section-number-data">{{ formatDateForInput(log.created_at) }}</span>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Paginación -->
<nav *ngIf="totalPages > 1" aria-label="Logs pagination" class="mt-3 d-flex justify-content-center">
  <ul class="pagination justify-content-center flex-wrap gap-1">
    <li class="page-item" [class.disabled]="currentPage === 1">
      <button class="page-link directions-btn" (click)="goToPage(currentPage - 1)">Previous</button>
    </li>

    <li
      class="page-item"
      *ngFor="let page of [].constructor(totalPages); let i = index"
      [class.active]="i + 1 === currentPage">
      <button class="page-link directions-btn" (click)="goToPage(i + 1)">
        {{ i + 1 }}
      </button>
    </li>

    <li class="page-item" [class.disabled]="currentPage === totalPages">
      <button class="page-link directions-btn" (click)="goToPage(currentPage + 1)">Next</button>
    </li>
  </ul>
</nav>
