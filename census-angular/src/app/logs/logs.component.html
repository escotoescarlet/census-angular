<app-messages [show]="showMsg" [message]="messageInfo" [type]="typeMessage"></app-messages>

<!-- Título -->
<div class="row justify-content-center">
  <div class="col-md-11 d-flex align-items-center">
    <i class="bi bi-collection me-2 icon-style"></i>
    <span class="section-title">Logs</span>
  </div>
</div>

<!-- Filtros -->
<div class="row justify-content-center mt-3">
  <div class="col-md-11">
    <div class="row g-2">
      <div class="col-md-3">
        <select class="form-select" [(ngModel)]="groupId" (change)="onGroupChange()">
          <option value="">All Groups</option>
          <option *ngFor="let g of groups" [value]="g.id">{{ g.name }}</option>
        </select>
      </div>
      <div class="col-md-3">
        <select class="form-select" [(ngModel)]="companyId" (change)="onCompanyChange()">
          <option value="">All Companies</option>
          <option *ngFor="let c of companies" [value]="c.id">{{ c.name }}</option>
        </select>
      </div>
      <div class="col-md-3">
        <select class="form-select" [(ngModel)]="memberId" (change)="onMemberChange()">
          <option value="">All Members</option>
          <option *ngFor="let m of members" [value]="m.id">{{ m.first }} {{ m.last }}</option>
        </select>
      </div>
    </div>
  </div>
</div>

<!-- Tabla -->
<div class="row justify-content-center table-row">
  <div class="col-md-11">
    <table class="table table-hover align-middle">
      <thead>
      <tr>
        <th class="text-start" style="width: 15%;">
          <div class="d-flex align-items-center">
            <span class="section-number-title">User</span>
            <button type="button" class="btn btn-link p-0 ms-2" (click)="toggleSortDirection()">
              <i class="bi" [ngClass]="{
                  'bi-arrow-up': direction === 'asc',
                  'bi-arrow-down': direction === 'desc'
                }"></i>
            </button>
          </div>
        </th>
        <th class="text-start" style="width: 15%;">
          <span class="section-number-title">Event</span>
        </th>
        <th style="width: 15%;">
          <span class="section-number-title">Item Type</span>
        </th>
        <th style="width: 35%;" class="text-start">
          <span class="section-number-title">Changes</span>
        </th>
        <th style="width: 20%;" class="text-start">
          <span class="section-number-title">Date</span>
        </th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let log of logs">
        <td class="text-start">
          <span class="section-number-data">{{ log.whodunnit }}</span>
        </td>
        <td class="text-start">
          <span class="section-number-data">{{ log.event }}</span>
        </td>
        <td class="text-start">
          <span class="section-number-data">{{ log.item_type }}</span>
        </td>
        <td class="text-start" style="white-space: pre-wrap; word-break: break-word;">
          <div style="max-height: 15em; overflow-y: auto;">
            <span class="section-number-data">{{ log.object }}</span>
          </div>
        </td>
        <td class="text-start">
          <span class="section-number-data">{{ formatDateForInput(log.created_at) }}</span>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Paginación -->
<nav *ngIf="totalPages > 1" aria-label="Logs pagination" class="mt-3 d-flex justify-content-center">
  <ul class="pagination">

    <!-- Previous -->
    <li class="page-item" [class.disabled]="currentPage === 1">
      <button class="page-link directions-btn" (click)="goToPage(currentPage - 1)">Previous</button>
    </li>

    <!-- First page -->
    <li class="page-item" [class.active]="currentPage === 1">
      <button class="page-link directions-btn" (click)="goToPage(1)">1</button>
    </li>

    <!-- Left ellipsis -->
    <li class="page-item disabled" *ngIf="currentPage > 4">
      <span class="page-link directions-btn">...</span>
    </li>

    <!-- Pages around current -->
    <li class="page-item"
        *ngFor="let page of getDisplayedPages()"
        [class.active]="currentPage === page">
      <button class="page-link directions-btn" (click)="goToPage(page)">
        {{ page }}
      </button>
    </li>

    <!-- Right ellipsis -->
    <li class="page-item disabled" *ngIf="currentPage < totalPages - 3">
      <span class="page-link directions-btn">...</span>
    </li>

    <!-- Last page -->
    <li class="page-item" [class.active]="currentPage === totalPages" *ngIf="totalPages > 1">
      <button class="page-link directions-btn" (click)="goToPage(totalPages)">
        {{ totalPages }}
      </button>
    </li>

    <!-- Next -->
    <li class="page-item" [class.disabled]="currentPage === totalPages">
      <button class="page-link directions-btn" (click)="goToPage(currentPage + 1)">Next</button>
    </li>

  </ul>
</nav>
