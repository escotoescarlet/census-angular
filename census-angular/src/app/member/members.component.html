<app-messages [show]="showMsg" [message]="messageInfo" [type]="typeMessage"></app-messages>

<div class="row justify-content-center">
  <div class="col-md-11 d-flex align-items-center">
    <i class="bi bi-collection me-2 icon-style"></i>
    <span class="section-title">Members</span>
  </div>
</div>

<div class="row justify-content-center mt-2">
  <div class="col-11 d-flex justify-content-between align-items-center">

    <!-- Input de búsqueda al extremo izquierdo con ancho tipo col-6 -->
    <div style="width: 50%;">
      <div class="input-group">
        <input
          type="text"
          class="form-control placeholder-input"
          placeholder="Example: Member A"
          [(ngModel)]="searchTerm"
          aria-label="Search by Name"
          aria-describedby="button-addon2"
        />
        <button class="btn btn-outline-secondary" type="button" id="button-addon2" (click)="getMembers(1)">
          <i class="bi bi-search"></i>
          <span class="search-btn">Search</span>
        </button>
      </div>
    </div>

    <!-- Botón al extremo derecho 
    <div>
      <button type="button" class="btn custom-btn" data-bs-toggle="modal" data-bs-target="#addMemberModal">
        <i class="bi bi-plus-circle"></i>
        New Member
      </button>
    </div>
    -->

    <div class="btn-group">
      <button type="button" class="btn custom-btn" data-bs-toggle="modal" data-bs-target="#addMemberModal">
        <i class="bi bi-plus-circle"></i>
        New Member
      </button>
      
      <button type="button" class="btn custom-btn dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
        <span class="visually-hidden">Toggle Dropdown</span>
      </button>

      <ul class="dropdown-menu">
        <li><a class="dropdown-item download-options" (click)="exportMembers()">Download All Members</a></li>
        <li><a class="dropdown-item download-options" (click)="benefitReport()">Download Billing Report</a></li>
        <li><a class="dropdown-item download-options" (click)="downloadNewCensusTemplate()">Download Census Template</a></li>
        <li><a class="dropdown-item download-options" (click)="downloadMassiveCompaniesTemplate()">Download Massive Company Template</a></li>
      </ul>
    </div>
  </div>
  <!-- Fila de tags para filtrar -->
  <div class="row justify-content-center mt-3">
    <div class="col-11" style="padding-left: 0px;">
      <div class="d-flex align-items-center flex-wrap gap-2">
        <span class="me-2 filter-title">Filter by Tag:</span>

        <!-- Selector de tags -->
        <select class="form-select form-select-sm tag-input" style="width: auto;"
            [(ngModel)]="selectedTag" (change)="onTagChange(selectedTag)">
          <option value="">All Tags</option>
          <option *ngFor="let tag of tags" [value]="tag.id">{{ tag.name }}</option>
        </select>

        <!-- Botón para limpiar filtro (opcional) -->
        <button *ngIf="selectedTag" class="btn btn-sm btn-outline-secondary ms-2"
            (click)="clearTagFilter()">
          Clear
        </button>
      </div>
    </div>
  </div>
</div>

<div class="row justify-content-center table-row">
  <div class="col-md-11">
    <table class="table text-center">
      <thead>
      <tr>
        <th scope="col" class="text-start">
          <div class="d-flex align-items-center">
            <span class="section-number-title">Name</span>
            <button type="button" class="btn btn-link p-0 ms-2" (click)="toggleSortDirection()">
              <i class="bi" [ngClass]="{
                            'bi-arrow-up': direction === 'asc',
                            'bi-arrow-down': direction === 'desc'
                        }"></i>
            </button>
          </div>
        </th>
        <th scope="col" class="text-start">
          <span class="section-number-title">Status</span>
        </th>
        <th scope="col">
          <span class="section-number-title">Actions</span>
        </th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let member of members">
        <th scope="row" class="text-start">
          <span class="section-number-data">
            {{ member.first }} {{ member.middle }} {{ member.last }}
          </span>
          <div *ngIf="member.tags?.length" class="mt-1">
            <span *ngFor="let tag of member.tags" class="badge bg-secondary me-1">
              {{ tag }}
            </span>
          </div>
        </th>
        <td class="text-start">
          <div class="form-check form-switch d-flex align-items-center">
            <input
              class="form-check-input"
              type="checkbox"
              role="switch"
              [checked]="member.is_active"
              id="switchCheckChecked-{{ member.id }}"
              (change)="onToggleActive($event, member, false)"/>

            <label
              class="form-check-label ms-2"
              [for]="'switchCheckChecked-' + member.id">
              <span class="section-number-data">Active</span>
            </label>
          </div>
        </td>
        <td>
          <button type="button" (click)="showDetails(member)" class="btn btn-link" data-bs-toggle="modal"
                  data-bs-target="#showMemberModal">
            <i class="bi bi-eye"></i>
          </button>

          <button type="button" (click)="prepareEditMember(member)" class="btn btn-link" data-bs-toggle="modal"
                  data-bs-target="#editMemberModal">
            <i class="bi bi-pencil text-success"></i>
          </button>

          <button type="button" (click)="readyToRemove(member)" class="btn btn-link" data-bs-toggle="modal"
                  data-bs-target="#removeMemberModal">
            <i class="bi bi-trash3 text-danger"></i>
          </button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<nav *ngIf="totalPages > 1" aria-label="Members pagination" class="mt-3 d-flex justify-content-center">
  <ul class="pagination">

    <!-- Previous -->
    <li class="page-item" [class.disabled]="currentPage === 1">
      <button class="page-link directions-btn" (click)="goToPage(currentPage - 1)">Previous</button>
    </li>

    <!-- First page -->
    <li class="page-item" [class.active]="currentPage === 1">
      <button class="page-link directions-btn" (click)="goToPage(1)">1</button>
    </li>

    <!-- Left ellipsis -->
    <li class="page-item disabled" *ngIf="currentPage > 4">
      <span class="page-link directions-btn">...</span>
    </li>

    <!-- Pages around current -->
    <li class="page-item"
        *ngFor="let page of getDisplayedPages()"
        [class.active]="currentPage === page">
      <button class="page-link directions-btn" (click)="goToPage(page)">
        {{ page }}
      </button>
    </li>

    <!-- Right ellipsis -->
    <li class="page-item disabled" *ngIf="currentPage < totalPages - 3">
      <span class="page-link directions-btn">...</span>
    </li>

    <!-- Last page -->
    <li class="page-item" [class.active]="currentPage === totalPages" *ngIf="totalPages > 1">
      <button class="page-link directions-btn" (click)="goToPage(totalPages)">
        {{ totalPages }}
      </button>
    </li>

    <!-- Next -->
    <li class="page-item" [class.disabled]="currentPage === totalPages">
      <button class="page-link directions-btn" (click)="goToPage(currentPage + 1)">Next</button>
    </li>

  </ul>
</nav>

<!-- Modal Create Member -->
<div class="modal fade" id="addMemberModal" tabindex="-1" aria-labelledby="addMemberModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <form [formGroup]="memberForm" (ngSubmit)="onSubmitCreate()">
        <div class="modal-header">
          <h5 class="modal-title" id="addMemberModalLabel">
            <i class="bi bi-person-plus me-2 icon-style"></i>
            <span class="section-title">New Member</span>
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <div class="container">
            <div class="row">
              <!-- General Data -->
              <div class="col-md-4 mb-3">
                <label class="section-number-title-section">General Data</label>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-person-badge"></i> First Name:</label>
                  <input type="text" formControlName="first" class="form-control mt-1 placeholder-input"
                         [ngClass]="{ 'is-invalid': memberForm.get('first')?.touched && memberForm.get('first')?.invalid }"/>
                  <div class="invalid-feedback"
                       *ngIf="memberForm.get('first')?.touched && memberForm.get('first')?.invalid">
                    <span class="error-text">First name is required.</span>
                  </div>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-person-badge"></i> Middle Name:</label>
                  <input type="text" formControlName="middle" class="form-control mt-1 placeholder-input"/>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-person-badge"></i> Last Name:</label>
                  <input type="text" formControlName="last" class="form-control mt-1 placeholder-input"
                         [ngClass]="{ 'is-invalid': memberForm.get('last')?.touched && memberForm.get('last')?.invalid }"/>
                  <div class="invalid-feedback"
                       *ngIf="memberForm.get('last')?.touched && memberForm.get('last')?.invalid">
                    <span class="error-text">Last name is required.</span>
                  </div>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-geo-alt"></i> Address:</label>
                  <input type="text" formControlName="address" class="form-control mt-1 placeholder-input"/>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-geo-alt"></i> Address Line 2:</label>
                  <input type="text" formControlName="address_line_2" class="form-control mt-1 placeholder-input"/>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-geo-alt"></i> City:</label>
                  <input type="text" formControlName="city" class="form-control mt-1 placeholder-input"/>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-geo-alt"></i> State:</label>
                  <input type="text" formControlName="state" class="form-control mt-1 placeholder-input"/>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-geo-alt"></i> Zipcode:</label>
                  <input type="text" formControlName="zipcode" class="form-control mt-1 placeholder-input"/>
                </div>
              </div>

              <!-- Contact Info -->
              <div class="col-md-4 mb-3">
                <label class="section-number-title-section">Contact Info</label>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-telephone"></i> Phone:</label>
                  <input type="text" formControlName="primary_phone" class="form-control mt-1 placeholder-input"/>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-envelope"></i> Email:</label>
                  <input type="email" formControlName="email" class="form-control mt-1 placeholder-input"
                         [ngClass]="{ 'is-invalid': memberForm.get('email')?.touched && memberForm.get('email')?.invalid }"/>
                  <div class="invalid-feedback"
                       *ngIf="memberForm.get('email')?.touched && memberForm.get('email')?.invalid">
                    <span class="error-text">Valid email is required.</span>
                  </div>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-hash"></i> External ID:</label>
                  <input type="text" formControlName="primary_external_id" class="form-control mt-1 placeholder-input"/>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-gender-ambiguous"></i> Gender:</label>
                  <select formControlName="gender" class="form-select">
                    <option value="">Select gender</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                  </select>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-calendar-event"></i> Date of birth:</label>
                  <input type="date" formControlName="dob" class="form-control mt-1 placeholder-input"/>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-translate"></i> Language:</label>
                  <select formControlName="language" class="form-select">
                    <option value="">Select language</option>
                    <option value="english">English</option>
                    <option value="spanish">Spanish</option>
                  </select>
                </div>

                <div class="mt-3 d-flex align-items-center">
                  <label class="title-info me-2 d-flex align-items-center">
                    <i class="bi bi-check-circle me-1"></i>
                    Status:
                  </label>
                  <div class="form-check form-switch mb-0">
                    <input class="form-check-input" type="checkbox" role="switch"
                           id="activeSwitch" formControlName="is_active"/>
                  </div>
                </div>
              </div>

              <!-- Ownership -->
              <div class="col-md-4 mb-3">
                <label class="section-number-title-section">Ownership</label>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-people"></i> Group:</label>
                  <select formControlName="group_id" class="form-select" (change)="onGroupChange()">
                    <option value="">Select a group</option>
                    <option *ngFor="let group of groups" [value]="group.id">{{ group.name }}</option>
                  </select>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-building"></i> Company:</label>
                  <select formControlName="company_id" class="form-select"
                          [disabled]="!memberForm.get('group_id')?.value"
                          [ngClass]="{'is-invalid': memberForm.get('company_id')?.touched && memberForm.get('company_id')?.invalid,
                            'is-disabled': !memberForm.get('group_id')?.value
                          }">
                    <option value="">Select a company</option>
                    <option *ngFor="let company of filteredCompanies" [value]="company.id">{{ company.name }}</option>
                  </select>

                  <div class="invalid-feedback"
                       *ngIf="memberForm.get('company_id')?.touched && memberForm.get('company_id')?.invalid">
                    <span class="error-text">Company is required.</span>
                  </div>

                  <div *ngIf="!memberForm.get('group_id')?.value" class="text-muted small mt-1">
                    Please select a group first
                  </div>

                </div>

              </div>
            </div>

            <!-- Benefits -->
            <div class="row mt-4">
              <div class="col-md-12">
                <label class="section-number-title-section mb-2">Benefits</label>
                <div formArrayName="benefits">
                  <div class="row">
                    <div class="col-md-4 mb-3" *ngFor="let benefit of benefits; let i = index">
                      <div class="d-flex justify-content-between align-items-center">
                        <div class="form-check">
                          <input type="checkbox" class="form-check-input" [formControlName]="i"
                                 [id]="'benefitCheck' + i"
                                 (change)="toggleBenefit(benefit.id, benefit.name, getCheckedValue($event))"/>
                          <label class="form-check-label ms-1 title-info-data" [for]="'benefitCheck' + i">
                            {{ benefit.name }}
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="submit"
                  class="btn btn-primary custom-btn d-flex align-items-center"
                  [disabled]="memberForm.invalid || isLoading">
            <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2" role="status"
                  aria-hidden="true"></span>
            {{ isLoading ? 'Saving...' : 'Save Member' }}
          </button>
          <button type="button" class="btn btn-secondary custom-btn-return" data-bs-dismiss="modal">Close</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal Edit Member -->
<div class="modal fade" id="editMemberModal" tabindex="-1" aria-labelledby="editMemberModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <form [formGroup]="memberForm" (ngSubmit)="onSaveMemberChanges()">
        <div class="modal-header">
          <h5 class="modal-title" id="addMemberModalLabel">
            <i class="bi bi-person-plus me-2 icon-style"></i>
            <span class="section-title">New Member</span>
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <div class="container">
            <div class="row">
              <!-- General Data -->
              <div class="col-md-4 mb-3">
                <label class="section-number-title-section">General Data</label>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-person-badge"></i> First Name:</label>
                  <input type="text" formControlName="first" class="form-control mt-1 placeholder-input"
                         [ngClass]="{ 'is-invalid': memberForm.get('first')?.touched && memberForm.get('first')?.invalid }"/>
                  <div class="invalid-feedback"
                       *ngIf="memberForm.get('first')?.touched && memberForm.get('first')?.invalid">
                    <span class="error-text">First name is required.</span>
                  </div>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-person-badge"></i> Middle Name:</label>
                  <input type="text" formControlName="middle" class="form-control mt-1 placeholder-input"/>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-person-badge"></i> Last Name:</label>
                  <input type="text" formControlName="last" class="form-control mt-1 placeholder-input"
                         [ngClass]="{ 'is-invalid': memberForm.get('last')?.touched && memberForm.get('last')?.invalid }"/>
                  <div class="invalid-feedback"
                       *ngIf="memberForm.get('last')?.touched && memberForm.get('last')?.invalid">
                    <span class="error-text">Last name is required.</span>
                  </div>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-geo-alt"></i> Address:</label>
                  <input type="text" formControlName="address" class="form-control mt-1 placeholder-input"/>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-geo-alt"></i> Address Line 2:</label>
                  <input type="text" formControlName="address_line_2" class="form-control mt-1 placeholder-input"/>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-geo-alt"></i> City:</label>
                  <input type="text" formControlName="city" class="form-control mt-1 placeholder-input"/>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-geo-alt"></i> State:</label>
                  <input type="text" formControlName="state" class="form-control mt-1 placeholder-input"/>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-geo-alt"></i> Zipcode:</label>
                  <input type="text" formControlName="zipcode" class="form-control mt-1 placeholder-input"/>
                </div>
              </div>

              <!-- Contact Info -->
              <div class="col-md-4 mb-3">
                <label class="section-number-title-section">Contact Info</label>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-telephone"></i> Phone:</label>
                  <input type="text" formControlName="primary_phone" class="form-control mt-1 placeholder-input"/>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-envelope"></i> Email:</label>
                  <input type="email" formControlName="email" class="form-control mt-1 placeholder-input"
                         [ngClass]="{ 'is-invalid': memberForm.get('email')?.touched && memberForm.get('email')?.invalid }"/>
                  <div class="invalid-feedback"
                       *ngIf="memberForm.get('email')?.touched && memberForm.get('email')?.invalid">
                    <span class="error-text">Valid email is required.</span>
                  </div>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-hash"></i> External ID:</label>
                  <input type="text" formControlName="primary_external_id" class="form-control mt-1 placeholder-input"/>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-gender-ambiguous"></i> Gender:</label>
                  <select formControlName="gender" class="form-select">
                    <option value="">Select gender</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                  </select>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-calendar-event"></i> Date of birth:</label>
                  <input type="date" formControlName="dob" class="form-control mt-1 placeholder-input"/>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-translate"></i> Language:</label>
                  <select formControlName="language" class="form-select">
                    <option value="">Select language</option>
                    <option value="english">English</option>
                    <option value="spanish">Spanish</option>
                  </select>
                </div>

                <div class="mt-3 d-flex align-items-center">
                  <label class="title-info me-2 d-flex align-items-center">
                    <i class="bi bi-check-circle me-1"></i>
                    Status:
                  </label>
                  <div class="form-check form-switch mb-0">
                    <input class="form-check-input" type="checkbox" role="switch"
                           id="activeSwitch" formControlName="is_active"/>
                  </div>
                </div>
              </div>

              <!-- Ownership -->
              <div class="col-md-4 mb-3">
                <label class="section-number-title-section">Ownership</label>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-people"></i> Group:</label>
                  <select formControlName="group_id" class="form-select" (change)="onGroupChange()">
                    <option value="">Select a group</option>
                    <option *ngFor="let group of groups" [value]="group.id">{{ group.name }}</option>
                  </select>
                </div>

                <div class="mt-3">
                  <label class="title-info d-block"><i class="bi bi-building"></i> Company:</label>
                  <select formControlName="company_id" class="form-select"
                          [disabled]="!memberForm.get('group_id')?.value"
                          [ngClass]="{
            'is-invalid': memberForm.get('company_id')?.touched && memberForm.get('company_id')?.invalid,
            'is-disabled': !memberForm.get('group_id')?.value
          }">
                    <option value="">Select a company</option>
                    <option *ngFor="let company of filteredCompanies" [value]="company.id">{{ company.name }}</option>
                  </select>
                  <div class="invalid-feedback"
                       *ngIf="memberForm.get('company_id')?.touched && memberForm.get('company_id')?.invalid">
                    <span class="error-text">Company is required.</span>
                  </div>
                  <div *ngIf="!memberForm.get('group_id')?.value" class="text-muted small mt-1">
                    Please select a group first
                  </div>
                </div>

              </div>
            </div>

            <!-- Benefits -->
            <div class="row mt-4">
              <div class="col-md-12">
                <label class="section-number-title-section mb-2">Benefits</label>
                <div formArrayName="benefits">
                  <div class="row">
                    <div class="col-md-4 mb-3" *ngFor="let benefit of benefits; let i = index">
                      <div class="d-flex justify-content-between align-items-center">
                        <div class="form-check">
                          <input type="checkbox" class="form-check-input" [formControlName]="i"
                                 [id]="'benefitCheck' + i"
                                 (change)="toggleBenefit(benefit.id, benefit.name, getCheckedValue($event))"/>
                          <label class="form-check-label ms-1 title-info-data" [for]="'benefitCheck' + i">
                            {{ benefit.name }}
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="submit"
                  class="btn btn-primary custom-btn d-flex align-items-center"
                  [disabled]="memberForm.invalid || isLoading">
            <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2" role="status"
                  aria-hidden="true"></span>
            {{ isLoading ? 'Saving...' : 'Save Member' }}
          </button>
          <button type="button" class="btn btn-secondary custom-btn-return" data-bs-dismiss="modal">Close</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal Show Member -->
<div class="modal fade" id="showMemberModal" tabindex="-1" aria-labelledby="showMemberModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="showMemberModalLabel">
          <i class="bi bi-building me-2 icon-style"></i>
          <span class="section-title">Member Details</span>
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <div class="container">
          <div class="row">
            <!-- General Data -->
            <div class="col-md-4 mb-3">
              <label class="section-number-title-section">General Data</label>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-person-badge"></i> Name:</label>
                <ng-container *ngIf="memberDetail?.first; else loading">
                  <span
                    class="title-info-data">{{ memberDetail.first }} {{ memberDetail.middle }} {{ memberDetail.last }}</span>
                </ng-container>
                <ng-template #loading>
                  <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                </ng-template>
              </div>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-geo-alt"></i> Address:</label>
                <ng-container *ngIf="memberDetail; else loading">
                  <span class="title-info-data d-block">{{ memberDetail.address || 'N/A' }}</span>
                  <span class="title-info-data d-block">{{ memberDetail.address_line_2 || '' }}</span>
                  <span class="title-info-data d-block">{{ memberDetail.city || '' }}
                    <span *ngIf="memberDetail.city && memberDetail.state">, </span>
                    {{ memberDetail.state || '' }}
                    <span *ngIf="memberDetail.zipcode">&nbsp;{{ memberDetail.zipcode }}</span>
                  </span>
                </ng-container>
                <ng-template #loading>
                  <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                </ng-template>
              </div>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-telephone"></i> Phone:</label>
                <ng-container *ngIf="memberDetail; else loading">
                  <span class="title-info-data">{{ memberDetail.primary_phone || 'N/A' }}</span>
                </ng-container>
                <ng-template #loading>
                  <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                </ng-template>
              </div>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-envelope"></i> Email:</label>
                <ng-container *ngIf="memberDetail; else loading">
                  <span class="title-info-data">{{ memberDetail.email || 'N/A' }}</span>
                </ng-container>
                <ng-template #loading>
                  <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                </ng-template>
              </div>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-hash"></i> External ID:</label>
                <ng-container *ngIf="memberDetail; else loading">
                  <span class="title-info-data">{{ memberDetail.primary_external_id || 'N/A' }}</span>
                </ng-container>
                <ng-template #loading>
                  <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                </ng-template>
              </div>
            </div>

            <div class="col-md-4 mb-3">
              <label class="section-number-title-section"></label>

              <div class="mt-3 d-flex align-items-center">
                <label class="title-info me-2 d-flex align-items-center">
                  <i class="bi bi-check-circle me-1"></i>
                  Status:
                </label>
                <ng-container *ngIf="memberDetail; else loading">
                  <div class="form-check form-switch mb-0">
                    <input class="form-check-input" type="checkbox" role="switch"
                      [checked]="memberDetail.is_active"
                      id="switchActivemember-{{ memberDetail.id }}"
                      (change)="onToggleActive($event, memberDetail, true)"/>
                  </div>
                </ng-container>
                <ng-template #loading>
                  <span class="skeleton-loader" style="width: 100px; height: 15px; display: inline-block;"></span>
                </ng-template>
              </div>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-gender-ambiguous"></i> Gender:</label>
                <ng-container *ngIf="memberDetail; else loading">
                  <span class="title-info-data">
                    {{ memberDetail.gender ? (memberDetail.gender.charAt(0).toUpperCase() + memberDetail.gender.slice(1)) : 'N/A' }}
                  </span>
                </ng-container>
                <ng-template #loading>
                  <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                </ng-template>
              </div>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-calendar-event"></i> Date of birth:</label>
                <ng-container *ngIf="memberDetail; else loading">
                  <span class="title-info-data">{{ memberDetail.dob || 'N/A' }}</span>
                </ng-container>
                <ng-template #loading>
                  <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                </ng-template>
              </div>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-translate"></i> Language:</label>
                <ng-container *ngIf="memberDetail; else loading">
                  <span class="title-info-data">
                   {{ memberDetail.language ? (memberDetail.language.charAt(0).toUpperCase() + memberDetail.language.slice(1)) : 'N/A' }}
                  </span>
                </ng-container>
                <ng-template #loading>
                  <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                </ng-template>
              </div>
            </div>

            <!-- Billing Info -->
            <div class="col-md-4 mb-3">
              <label class="section-number-title-section">Ownership</label>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-people"></i> Group:</label>
                <ng-container *ngIf="memberDetail; else loading">
                  <span class="title-info-data">{{ memberDetail.group.name || 'N/A' }}</span>
                </ng-container>
                <ng-template #loading>
                  <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                </ng-template>
              </div>

              <div class="mt-3">
                <label class="title-info d-block"><i class="bi bi-building"></i> Company:</label>
                <ng-container *ngIf="memberDetail; else loading">
                  <span class="title-info-data">{{ memberDetail.company.name || 'N/A' }}</span>
                </ng-container>
                <ng-template #loading>
                  <span class="skeleton-loader" style="width: 120px; height: 15px; display: inline-block;"></span>
                </ng-template>
              </div>
            </div>
          </div>

          <!-- Benefits -->
          <div class="row mt-4">
            <div class="col-md-12">
              <label class="section-number-title-section mb-2">Benefits</label>
              <div *ngIf="memberDetail?.benefits && memberDetail.benefits.length > 0">
                <div class="row">
                  <div class="col-md-4 mb-3" *ngFor="let b of memberDetail.benefits">
                    <div class="d-flex justify-content-between align-items-center">
                      <span class="title-info-data">{{ b.name }}</span>
                      <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch"
                               [checked]="b.enabled"
                               id="switchCheckMemberBenefit-{{ b.id }}"
                               disabled/>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary custom-btn-return" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Remove Member -->
<div class="modal fade" id="removeMemberModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          <i class="bi bi-collection me-2 icon-style"></i>
          <span class="section-title">Remove Member</span>
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body text-center d-flex flex-column align-items-center justify-content-center">
        <i class="bi bi-exclamation-octagon" style="font-size: 48px; color: #dc3545;"></i>
        <p class="want-delete mt-3">
          Are you sure you want to delete member <strong>{{ memberToRemove?.name }}</strong>?
        </p>
      </div>


      <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="deleteMember()">
          <i class="bi bi-trash"></i>
          Remove
        </button>
        <button type="button" class="btn btn-secondary custom-btn-return" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

