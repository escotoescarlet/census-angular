<app-messages [show]="showMsg" [message]="messageInfo" [type]="typeMessage"></app-messages>

<div class="row justify-content-center">
  <div class="col-md-11 d-flex align-items-center">
    <i class="bi bi-collection me-2 icon-style"></i>
    <span class="section-title">Reports</span>
  </div>
</div>

<div class="row mt-4">
    <div class="col-md-3">
      <div class="card">
          <div class="d-flex justify-content-center mt-3">
              <i class="bi bi-file-earmark-excel report-icon-style"></i>
          </div>
          <div class="card-body justify-content-center">
              <h5 class="card-title card-title-style">Benefit Report</h5>
              <p class="card-text card-text-style">The Benefit Report provides a detailed breakdown of all active and inactive benefits across companies or groups, including benefit names.</p>
              <button class="btn custom-btn w-100" data-bs-toggle="modal" data-bs-target="#modalBenefitReport">Generate</button>
          </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card">
          <div class="d-flex justify-content-center mt-3">
              <i class="bi bi-file-earmark-excel report-icon-style"></i>
          </div>
          <div class="card-body justify-content-center">
              <h5 class="card-title card-title-style">Member Status</h5>
              <p class="card-text card-text-style">The Member Status Report provides a detailed list of all members whose enrollment status changed within a date range, including key personal and benefit details.</p>
              <button class="btn custom-btn w-100" data-bs-toggle="modal" data-bs-target="#modalStatusReport">Generate</button>
          </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card">
          <div class="d-flex justify-content-center mt-3">
              <i class="bi bi-file-earmark-excel report-icon-style"></i>
          </div>
          <div class="card-body justify-content-center">
              <h5 class="card-title card-title-style">Snapshot Enrollment</h5>
              <p class="card-text card-text-style">The Snapshot Enrollment Report provides a comprehensive record of all active members who experienced enrollment status changes within a date range.</p>
              <button class="btn custom-btn w-100" data-bs-toggle="modal" data-bs-target="#modalSnaphostEnrollmentReport">Generate</button>
          </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card">
          <div class="d-flex justify-content-center mt-3">
              <i class="bi bi-file-earmark-excel report-icon-style"></i>
          </div>
          <div class="card-body justify-content-center">
              <h5 class="card-title card-title-style">Member Enrollment</h5>
              <p class="card-text card-text-style">The Company Members Enrollment Report delivers a complete list of all members in a company whose enrollment status changed during a selected date range.</p>
              <button class="btn custom-btn w-100" data-bs-toggle="modal" data-bs-target="#modalCompanyMemberEnrollmentReport">Generate</button>
          </div>
      </div>
    </div>
</div>

<div class="row mt-4">
  <div class="col-md-3">
      <div class="card">
          <div class="d-flex justify-content-center mt-3">
              <i class="bi bi-file-earmark-excel report-icon-style"></i>
          </div>
          <div class="card-body justify-content-center">
              <h5 class="card-title card-title-style">Billing Report</h5>
              <p class="card-text card-text-style">The Company Benefits Report provides a detailed summary of each companyâ€™s active members, their assigned benefits, and related pricing data within the selected period.</p>
              <button type="button"
                class="btn custom-btn w-100"
                [disabled]="loadingBillingInfo"
                (click)="onDownloadBillingReport()">
                <ng-container *ngIf="!loadingBillingInfo; else loadingTpl">
                    <i class="bi bi-download me-1"></i>
                    Download
                </ng-container>
                <ng-template #loadingTpl>
                    <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                    Downloading...
                </ng-template>
            </button>
          </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card">
          <div class="d-flex justify-content-center mt-3">
              <i class="bi bi-file-earmark-excel report-icon-style"></i>
          </div>
          <div class="card-body justify-content-center">
              <h5 class="card-title card-title-style">Group Report</h5>
              <p class="card-text card-text-style">The Groups Report provides a complete overview of all groups in the system, including identifiers, related companies, and membership details at the time of reporting.</p>
              <button type="button"
                class="btn custom-btn w-100"
                [disabled]="loadingGroupInfo"
                (click)="onDownloadGroupReport()">
                <ng-container *ngIf="!loadingGroupInfo; else loadingTpl">
                    <i class="bi bi-download me-1"></i>
                    Download
                </ng-container>
                <ng-template #loadingTpl>
                    <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                    Downloading...
                </ng-template>
            </button>
          </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card">
          <div class="d-flex justify-content-center mt-3">
              <i class="bi bi-file-earmark-excel report-icon-style"></i>
          </div>
          <div class="card-body justify-content-center">
              <h5 class="card-title card-title-style">Spanish Speakers</h5>
              <p class="card-text card-text-style">The Spanish Speakers Report provides a detailed list of all members who have Spanish as their preferred language and contact details, and demographic data.</p>
              <button type="button"
                class="btn custom-btn w-100"
                [disabled]="loadingSpanishSpeakersInfo"
                (click)="onDownloadSpanishSpeakersReport()">
                <ng-container *ngIf="!loadingSpanishSpeakersInfo; else loadingTpl">
                    <i class="bi bi-download me-1"></i>
                    Download
                </ng-container>
                <ng-template #loadingTpl>
                    <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                    Downloading...
                </ng-template>
            </button>
          </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card">
          <div class="d-flex justify-content-center mt-3">
              <i class="bi bi-file-earmark-excel report-icon-style"></i>
          </div>
          <div class="card-body justify-content-center">
              <h5 class="card-title card-title-style">Duplicated Report</h5>
              <p class="card-text card-text-style">The Duplicated Members Report identifies and lists members with potential duplicate records, including company details, contact information, demographics, and unique identifiers.</p>
              <button type="button"
                class="btn custom-btn w-100"
                [disabled]="loadingDuplicatedInfo"
                (click)="onDownloadDuplicatedReport()">
                <ng-container *ngIf="!loadingDuplicatedInfo; else loadingTpl">
                    <i class="bi bi-download me-1"></i>
                    Download
                </ng-container>
                <ng-template #loadingTpl>
                    <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                    Downloading...
                </ng-template>
            </button>
          </div>
      </div>
    </div>
</div>

<div class="row mt-4 mb-4">
  <div class="col-md-3">
      <div class="card">
        <div class="d-flex justify-content-center mt-3">
            <i class="bi bi-file-earmark-excel report-icon-style"></i>
        </div>
        <div class="card-body justify-content-center">
            <h5 class="card-title card-title-style">Empty Benefits</h5>
            <p class="card-text card-text-style">The Blank Benefits Report lists all members without assigned benefits, showing their status, company, demographics, and contact information at the time of reporting.</p>
            <button type="button"
              class="btn custom-btn w-100"
              [disabled]="loadingEmptyBenefitsInfo"
              (click)="onDownloadEmptyBenefitsReport()">
              <ng-container *ngIf="!loadingEmptyBenefitsInfo; else loadingTpl">
                  <i class="bi bi-download me-1"></i>
                  Download
              </ng-container>
              <ng-template #loadingTpl>
                  <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                  Downloading...
              </ng-template>
          </button>
        </div>
    </div>
  </div>

  <div class="col-md-3">
      <div class="card">
          <div class="d-flex justify-content-center mt-3">
              <i class="bi bi-file-earmark-excel report-icon-style"></i>
          </div>
          <div class="card-body justify-content-center">
              <h5 class="card-title card-title-style">Member In Companies</h5>
              <p class="card-text card-text-style">The Duplicated Members Report identifies and lists members with potential duplicate records, including company details, contact information, demographics, and unique identifiers.</p>
              <button class="btn custom-btn w-100" data-bs-toggle="modal" data-bs-target="#modalMembersCustomCompaniesReport">Generate</button>
          </div>
      </div>
    </div>
</div>




<!-- Modals Data -->

<!-- Modal Benefit Report -->
<div class="modal fade" id="modalBenefitReport" tabindex="-1" aria-labelledby="modalBenefitReportLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalBenefitReportLabel">
            <i class="bi bi-file-earmark-excel me-2 icon-style"></i>
            <span class="section-title">Benefit Report</span>
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form>
            <!-- Benefit -->
            <div class="mb-3" *ngIf="benefits?.length">
            <label for="benefitSelect" class="form-label text-modal-title">Benefit</label>
            <select id="benefitSelect"
                    class="form-select text-modal-body"
                    [(ngModel)]="selectedBenefitId"
                    name="benefitSelect"
                    required>
                <option [ngValue]="null" disabled>Select a benefit</option>
                <option *ngFor="let b of benefits" [ngValue]="b.id">
                {{ b.name }}
                </option>
            </select>
            <div class="mt-2 text-modal-body-note">Note: Choose which benefit to include in the report.</div>
            </div>

            <!-- Date range -->
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="fromDate" class="form-label text-modal-title">From</label>
                    <input id="fromDate"
                        type="date"
                        class="form-control text-modal-body"
                        [(ngModel)]="fromDate"
                        name="fromDate"
                        required>
                </div>
                <div class="col-md-6">
                    <label for="toDate" class="form-label text-modal-title">To</label>
                    <input id="toDate"
                        type="date"
                        class="form-control text-modal-body"
                        [(ngModel)]="toDate"
                        name="toDate"
                        required>
                </div>
            </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button"
            class="btn custom-btn"
            [disabled]="!isFormValid() || loadingBenefitReport"
            (click)="onDownloadBenefitReport()">
            <ng-container *ngIf="!loadingBenefitReport; else loadingTpl">
                <i class="bi bi-download me-1"></i>
                Download
            </ng-container>
            <ng-template #loadingTpl>
                <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                Generating...
            </ng-template>
        </button>

        <button type="button" class="btn custom-btn-return" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Member Status Report -->
<div class="modal fade" id="modalStatusReport" tabindex="-1" aria-labelledby="modalStatusReportLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalStatusReportLabel">
            <i class="bi bi-file-earmark-excel me-2 icon-style"></i>
            <span class="section-title">Member Status Report</span>
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form>
            <!-- Date range -->
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="fromDateMemberStatus" class="form-label text-modal-title">From</label>
                    <input id="fromDateMemberStatus"
                        type="date"
                        class="form-control text-modal-body"
                        [(ngModel)]="fromDateMemberStatus"
                        name="fromDateMemberStatus"
                        required>
                </div>
                <div class="col-md-6">
                    <label for="toDateMemberStatus" class="form-label text-modal-title">To</label>
                    <input id="toDateMemberStatus"
                        type="date"
                        class="form-control text-modal-body"
                        [(ngModel)]="toDateMemberStatus"
                        name="toDateMemberStatus"
                        required>
                </div>
            </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button"
            class="btn custom-btn"
            [disabled]="!isFormMemberStatusValid() || loadingMemberStatusReport"
            (click)="onDownloadMemberStatusReport()">
            <ng-container *ngIf="!loadingMemberStatusReport; else loadingTpl">
                <i class="bi bi-download me-1"></i>
                Download
            </ng-container>
            <ng-template #loadingTpl>
                <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                Generating...
            </ng-template>
        </button>

        <button type="button" class="btn custom-btn-return" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Snaphot Enrollment Report -->
<div class="modal fade" id="modalSnaphostEnrollmentReport" tabindex="-1" aria-labelledby="modalSnaphostEnrollmentReportLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalSnaphostEnrollmentReportLabel">
            <i class="bi bi-file-earmark-excel me-2 icon-style"></i>
            <span class="section-title">Snapshot Enrollment Report</span>
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form>
            <!-- Date range -->
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="fromDateSnaphostEnrollment" class="form-label text-modal-title">From</label>
                    <input id="fromDateSnaphostEnrollment"
                        type="date"
                        class="form-control text-modal-body"
                        [(ngModel)]="fromDateSnaphostEnrollment"
                        name="fromDateSnaphostEnrollment"
                        required>
                </div>
                <div class="col-md-6">
                    <label for="toDateSnaphostEnrollment" class="form-label text-modal-title">To</label>
                    <input id="toDateSnaphostEnrollment"
                        type="date"
                        class="form-control text-modal-body"
                        [(ngModel)]="toDateSnaphostEnrollment"
                        name="toDateSnaphostEnrollment"
                        required>
                </div>
            </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button"
            class="btn custom-btn"
            [disabled]="!isSnaphostEnrollmentValid() || loadingSnaphostEnrollment"
            (click)="onDownloadSnaphostReport()">
            <ng-container *ngIf="!loadingSnaphostEnrollment; else loadingTpl">
                <i class="bi bi-download me-1"></i>
                Download
            </ng-container>
            <ng-template #loadingTpl>
                <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                Generating...
            </ng-template>
        </button>

        <button type="button" class="btn custom-btn-return" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Member Enrollment by Date Report -->
<div class="modal fade" id="modalCompanyMemberEnrollmentReport" tabindex="-1" aria-labelledby="modalCompanyMemberEnrollmentReportLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalCompanyMemberEnrollmentReportLabel">
            <i class="bi bi-file-earmark-excel me-2 icon-style"></i>
            <span class="section-title">Member Enrollment by Date</span>
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form>
            <!-- Benefit -->
            <div class="mb-3" *ngIf="companies?.length">
              <label for="companySelect" class="form-label text-modal-title">Company</label>
              <select id="companySelect"
                      class="form-select text-modal-body"
                      [(ngModel)]="companySelectedId"
                      name="companySelect"
                      required>
                  <option [ngValue]="null" disabled>Select a company</option>
                  <option *ngFor="let c of companies" [ngValue]="c.id">
                  {{ c.name }}
                  </option>
              </select>
              <div class="mt-2 text-modal-body-note">Note: Choose which company to include in the report.</div>
            </div>

            <!-- Date range -->
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="fromDateMemberEnrollment" class="form-label text-modal-title">From</label>
                    <input id="fromDateMemberEnrollment"
                        type="date"
                        class="form-control text-modal-body"
                        [(ngModel)]="fromDateMemberEnrollment"
                        name="fromDateMemberEnrollment"
                        required>
                </div>
                <div class="col-md-6">
                    <label for="toDateMemberEnrollment" class="form-label text-modal-title">To</label>
                    <input id="toDateMemberEnrollment"
                        type="date"
                        class="form-control text-modal-body"
                        [(ngModel)]="toDateMemberEnrollment"
                        name="toDateMemberEnrollment"
                        required>
                </div>
            </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button"
            class="btn custom-btn"
            [disabled]="!isMemberEnrollmentFormValid() || loadingMemberEnrollment"
            (click)="onDownloadCompanyMemberEnrollmentReport()">
            <ng-container *ngIf="!loadingMemberEnrollment; else loadingTpl">
                <i class="bi bi-download me-1"></i>
                Download
            </ng-container>
            <ng-template #loadingTpl>
                <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                Generating...
            </ng-template>
        </button>

        <button type="button" class="btn custom-btn-return" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Member Custom Companies Report -->
<div class="modal fade" id="modalMembersCustomCompaniesReport" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">
          <i class="bi bi-file-earmark-excel me-2 icon-style"></i>
          <span class="section-title">Member In Companies</span>
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <!-- Selector -->
        <div class="mb-3" *ngIf="companies?.length">
          <label for="companySelectCustom" class="form-label text-modal-title">Company</label>
          <select id="companySelectCustom"
                  class="form-select text-modal-body"
                  [(ngModel)]="selectedCompanyId"
                  name="companySelectCustom"
                  (ngModelChange)="onCompanySelected()">
            <option [ngValue]="null" disabled>Select a company</option>
            <option *ngFor="let c of companies; trackBy: trackByCompanyId" [ngValue]="c.id">
              {{ c.name }}
            </option>
          </select>
          <div class="mt-2 text-modal-body-note">Click a company to add it to the list.</div>
        </div>

        <!-- Lista de seleccionadas -->
        <div class="mt-3" *ngIf="selectedCompanies.length">
          <div class="text-modal-title mb-1">Selected companies ({{ selectedCompanies.length }})</div>
          <div class="d-flex flex-wrap gap-2">
            <span class="badge bg-secondary d-flex align-items-center" *ngFor="let c of selectedCompanies; trackBy: trackByCompanyId">
              {{ c.name }}
              <button type="button"
                      class="btn btn-sm btn-link text-light ms-2 p-0"
                      (click)="removeCompanyFromList(c.id)">
                &times;
              </button>
            </span>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button"
                class="btn custom-btn"
                [disabled]="!selectedCompanies.length || loadingMemberCompaniesInfo"
                (click)="onDownloadMemberInCustomCompaniesReport()">
          <ng-container *ngIf="!loadingMemberCompaniesInfo; else loadingTpl">
            <i class="bi bi-download me-1"></i>
            Download
          </ng-container>
          <ng-template #loadingTpl>
            <span class="spinner-border spinner-border-sm me-2"></span>
            Generating...
          </ng-template>
        </button>
        <button type="button" class="btn custom-btn-return" data-bs-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>






